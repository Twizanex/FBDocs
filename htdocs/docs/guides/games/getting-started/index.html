<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>https://developers.facebook.com/docs/guides/games/getting-started/</title>
<link rel="stylesheet" href="/css/common.css" media="screen" />
<script src="/js/common.js"></script>
</head>
<body>
<a id="oklahomer-orig-url" href="https://developers.facebook.com/docs/guides/games/getting-started/">https://developers.facebook.com/docs/guides/games/getting-started/</a>

<div id="oklahomer-menu-wrapper">
<div class="toplevelnav">
<ul>
<li class="active withsubsections">
<a class="selected" href="/docs/" name="https://developers.facebook.com/docs/">
<div class="navSectionTitle">Getting Started</div>
</a>
<ul class="subsections">
<li>
<a href="/docs/guides/web/" name="https://developers.facebook.com/docs/guides/web">Websites</a>
</li>
<li>
<a href="/docs/guides/canvas/" name="https://developers.facebook.com/docs/guides/canvas">Apps on Facebook</a>
</li>
<li>
<a href="/docs/guides/mobile/" name="https://developers.facebook.com/docs/guides/mobile">Mobile</a>
</li>
<li>
<a href="/docs/appcenter/" name="https://developers.facebook.com/docs/appcenter/">App Center</a>
</li>
<li>
<a href="/docs/bestpractices/" name="https://developers.facebook.com/docs/bestpractices/">Best Practices</a>
</li>
<li>
<a href="/docs/samples/" name="https://developers.facebook.com/docs/samples">Samples &amp; How-Tos</a>
</li>
<li>
<a href="https://developers.facebook.com/videos" name="https://developers.facebook.com/videos" target="_blank">Videos</a>
</li>
</ul>
</li>
<li>
<a href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts">
<div class="navSectionTitle">Core Concepts</div>
</a>
</li>
<li>
<a href="/docs/advancedtopics/" name="https://developers.facebook.com/docs/advancedtopics">
<div class="navSectionTitle">Advanced Topics</div>
</a>
</li>
<li>
<a href="/docs/sdks/" name="https://developers.facebook.com/docs/sdks">
<div class="navSectionTitle">SDK Reference</div>
</a>
</li>
<li>
<a href="https://developers.facebook.com/tools" name="https://developers.facebook.com/tools" target="_blank">
<div class="navSectionTitle">Tools</div>
</a>
</li>
</ul>
</div>
<ul id="navsubsectionpages">
<li>
</li>
<li class="active">
<h5>Getting Started</h5>
<ul>
<li>
<a href="/docs/appsonfacebook/tutorial/" name="http://developers.facebook.com/docs/appsonfacebook/tutorial/">Canvas Tutorial</a>
</li>
<li>
<a class="selected" href="/docs/guides/games/getting-started/" name="http://developers.facebook.com/docs/guides/games/getting-started/">Social Games Tutorial</a>
</li>
<li>
<a href="/docs/guides/games/growth/" name="http://developers.facebook.com/docs/guides/games/growth/">Social Channels for Games</a>
</li>
<li>
<a href="/docs/requests/" name="http://developers.facebook.com/docs/requests/">Requests Overview</a>
</li>
<li>
<a href="/docs/appsonfacebook/pagetabs/" name="http://developers.facebook.com/docs/appsonfacebook/pagetabs/">Page Tab Tutorial</a>
</li>
</ul>
</li>
<li>
<h5>Best Practices</h5>
<ul>
<li>
<a href="/docs/guides/games/auth/" name="http://developers.facebook.com/docs/guides/games/auth/">Authentication Pro-tips</a>
</li>
<li>
<a href="/docs/guides/games/requests/" name="http://developers.facebook.com/docs/guides/games/requests/">Requests Pro-tips</a>
</li>
<li>
<a href="/docs/guides/games/feed/" name="http://developers.facebook.com/docs/guides/games/feed/">Feed Pro-tips</a>
</li>
<li>
<a href="/docs/guides/games/canvas/" name="http://developers.facebook.com/docs/guides/games/canvas/">Integrating with Canvas</a>
</li>
<li>
<a href="/docs/guides/games/monetization/" name="http://developers.facebook.com/docs/guides/games/monetization/">Games Monetization</a>
</li>
</ul>
</li>
<li>
<h5>Showcase</h5>
<ul>
<li>
<a href="/docs/arcadegames/" name="http://developers.facebook.com/docs/arcadegames/">Arcade Games</a>
</li>
<li>
<a href="/docs/bingobash/" name="http://developers.facebook.com/docs/bingobash/">Bingo Bash</a>
</li>
<li>
<a href="/docs/diamonddash/" name="http://developers.facebook.com/docs/diamonddash/">Diamond Dash</a>
</li>
<li>
<a href="http://developers.facebook.com/showcase/games/" name="http://developers.facebook.com/showcase/games/" target="_blank">Games Gallery</a>
</li>
</ul>
</li>
<li>
<h5>How Tos</h5>
<ul>
<li>
<a href="/docs/fluidcanvas/" name="http://developers.facebook.com/docs/fluidcanvas/">Fluid Canvas</a>
</li>
<li>
<a href="/docs/feed-gaming/" name="http://developers.facebook.com/docs/feed-gaming/">Feed Gaming</a>
</li>
<li>
<a href="/docs/hideflashcallback/" name="http://developers.facebook.com/docs/hideflashcallback/">Flash wmode</a>
</li>
<li>
<a href="/docs/guides/games/custom-multi-friend-selector/" name="http://developers.facebook.com/docs/guides/games/custom-multi-friend-selector/">Multi-Friend Selector</a>
</li>
</ul>
</li>
<li>
<h5>Reference</h5>
<ul>
<li>
<a href="/docs/achievements/" name="http://developers.facebook.com/docs/achievements/">Achievements</a>
</li>
<li>
<a href="/docs/score/" name="http://developers.facebook.com/docs/score/">Scores</a>
</li>
<li>
<a href="/docs/reqests_dialog/" name="http://developers.facebook.com/docs/reqests_dialog/">Requests Dialog</a>
</li>
<li>
<a href="/docs/fb_source/" name="http://developers.facebook.com/docs/fb_source/">fb_source Parameter</a>
</li>
</ul>
</li>
</ul></div>

<div id="oklahomer-content-wrapper">
<div class="header">
<div class="content">
<h1>Social Games Tutorial</h1>
<div class="breadcrumbs">
<a href="/docs/" name="https://developers.facebook.com/docs/">Getting Started</a> › <a href="/docs/guides/canvas/" name="https://developers.facebook.com/docs/guides/canvas/">Apps on Facebook</a> › <a href="/docs/guides/games/getting-started/" name="https://developers.facebook.com/docs/guides/games/getting-started/">Social Games Tutorial</a>
</div>
</div>
</div>
<p>Facebook Platform enables Game Developers to add social features into their games allowing them to create social experiences for their players.</p>
<p>This guide will walk you through 7 steps to quickly implement Facebook Platform into an existing game. We will be using a sample game, Critical Mass, that was created for the purposes of this guide. Critical Mass was built in HTML5 and runs in both desktop and mobile web browsers.</p>
<p>You can download the Critical Mass source from <a href="https://github.com/fbsamples/CriticalMass" name="https://github.com/fbsamples/CriticalMass" target="_blank">github</a>. The project is separated into two directores <a href="https://github.com/fbsamples/CriticalMass/tree/master/web" name="https://github.com/fbsamples/CriticalMass/tree/master/web" target="_blank">Web</a> and <a href="https://github.com/fbsamples/CriticalMass/tree/master/ios" name="https://github.com/fbsamples/CriticalMass/tree/master/ios" target="_blank">iOS</a> which contain the source for each implementation. Within these directories <a href="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" name="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" target="_blank">web/criticalmass</a> contains the game we will be starting with, without any social features. Finally <a href="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmasscomplete" name="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmasscomplete" target="_blank">web/criticalmasscomplete</a> contains the finished game that has implemented Facebook Platform.</p>
<p>As you follow along in the steps below, remember you can also check your work against <a href="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmasscomplete" name="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmasscomplete" target="_blank">web/criticalmasscomplete</a> to make sure you are on the right track.</p>
<p>This guide will walk through the following steps:</p>
<ul>
<li>
<a href="/docs/guides/games/getting-started/#step0" name="https://developers.facebook.com/docs/guides/games/getting-started/#step0">Step 0 - Create a Facebook App in the Developer App</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step1" name="https://developers.facebook.com/docs/guides/games/getting-started/#step1">Step 1 - Authorization</a>
<ul>
<li>
<a href="/docs/guides/games/getting-started/#step1a" name="https://developers.facebook.com/docs/guides/games/getting-started/#step1a">Step 1a - Authorization on Canvas</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step1b" name="https://developers.facebook.com/docs/guides/games/getting-started/#step1b">Step 1b - Authorization on Mobile Web</a>
</li>
</ul>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step2" name="https://developers.facebook.com/docs/guides/games/getting-started/#step2">Step 2 - Implement Invites with Requests</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step3" name="https://developers.facebook.com/docs/guides/games/getting-started/#step3">Step 3 - Implement Bragging Stories with Feed</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step4" name="https://developers.facebook.com/docs/guides/games/getting-started/#step4">Step 4 - Implement the Facebook Scores API</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step5" name="https://developers.facebook.com/docs/guides/games/getting-started/#step5">Step 5 - Load a leaderboard with the Facebook Scores API</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step6" name="https://developers.facebook.com/docs/guides/games/getting-started/#step6">Step 6 - Implement the Facebook Achievements API</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/#step7" name="https://developers.facebook.com/docs/guides/games/getting-started/#step7">Step 7 - Create an App Detail page for App Center</a>
</li>
</ul>
<hr />
<h2>Requirements</h2>
<p>In order to run the sample, you need the following:</p>
<ul>
<li>
<a href="http://php.net/" name="http://php.net/" target="_blank">PHP</a>
</li>
<li>A Web Server that supports PHP (example: Heroku)</li>
<li>A public URL for your game</li>
<li>Your favorite browser</li>
<li>A mobile browser or iOS/Android simulator</li>
</ul>
<hr />
<p>Take the time to get familiar our sample, Critical Mass. Upload the source code from <a href="https://github.com/fbsamples/CriticalMass/tree/master/web" name="https://github.com/fbsamples/CriticalMass/tree/master/web" target="_blank">github</a> to your web server and preview Critical Mass in a browser.</p>
<p>
<img src="https://developers.facebook.com/attachment/cm_init.jpg" width="700" />
</p>
<p>
<a name="step0">
</a>  </p>
<h2>Step 0 - Create a Facebook App in the Developer App</h2>
<p>Before we can get started implementing the Facebook Platform features into Critical Mass, we will first need to create a new App on Facebook for it. This is the same process you will follow for all Apps that you integrate with Facebook, regardless of the platform you are developing for. In our case we are working on Canvas and Mobile Web so we will fill out the relevant sections.</p>
<p>First navigate to the Facebook <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">Developer App</a>. If you have not already registered as a Facebook Developer, do this now.</p>
<p>Next click the &quot;Create New App&quot; button which will open a dialog prompting for App Name and App Namespace.</p>
<p>
<img src="https://developers.facebook.com/attachment/create_new_app.jpg" width="620" />
</p>
<p>The &apos;App Name&apos; is how your app will be displayed in Search, Bookmarks and various other locations on Facebook. &apos;App Namespace&apos; will be used as part of your Canvas Page URL and must be unique. In our case, our Canvas Page URL will be apps.facebook.com/criticalmasscomplete.</p>
<p>Next you will need to fill out the appropriate sections for the platforms you are developing for. In our case we will fill out &apos;App on Facebook&apos; for Canvas and &apos;Mobile Web&apos; for our mobile versions. The URL we enter into these fields is the endpoint where our game can be loaded from, i.e. where you uploaded the source files from <a href="https://github.com/fbsamples/CriticalMass/tree/master/web" name="https://github.com/fbsamples/CriticalMass/tree/master/web" target="_blank">github</a>.</p>
<p>
<img src="https://developers.facebook.com/attachment/app_settings_basic.jpg" width="690" />
</p>
<p>Finally navigate to the Advanced Settings and make sure that &quot;Sandbox Mode&quot; is enabled. This will ensure that only Developers of your game (which can be configured in the Roles section) can see your app while it&apos;s in development. Once you are ready to launch your game to the public, set &quot;Sandbox Mode&quot; to disabled.</p>
<p>
<img src="https://developers.facebook.com/attachment/app_settings_advanced.jpg" width="690" />
</p>
<p>While you are in the Advanced Settings you can also set your Canvas dimensions. For Critical Mass we will set our width to Fluid, which gives us the full browser width available, and our height to Fixed at 600 px. For more information on these settings check out the <a href="/docs/fluidcanvas/" name="https://developers.facebook.com/docs/fluidcanvas/">Fluid Canvas</a> docs.</p>
<p>That&apos;s it, you should now be ready to begin implementing Facebook Platform into your game.</p>
<p>
<a name="step1">
</a>  </p>
<h2>Step 1 - Authorization</h2>
<p>Since Critical Mass is both a Canvas and Mobile Web browser game we will need to implement Authorization for both cases. While technically Canvas games can also implement Authorization in the same manner as Mobile Web and external websites, Canvas has the added benefit of being loaded within an iframe on apps.facebook.com. This allows Canvas games to receive the <a href="/docs/authentication/signed_request/" name="https://developers.facebook.com/docs/authentication/signed_request/">Signed Request</a> parameter, simplifying authorization. <a name="step1a">
</a>  </p>
<h3>Step 1a - Authorization on Canvas</h3>
<p>We will be using the <a href="/docs/reference/php/" name="https://developers.facebook.com/docs/reference/php/">PHP SDK</a> available on <a href="https://github.com/facebook/facebook-php-sdk" name="https://github.com/facebook/facebook-php-sdk" target="_blank">github</a> for this step. If you have downloaded the <a href="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" name="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" target="_blank">Critical Mass sample</a> from <a href="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" name="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" target="_blank">github</a> already, the PHP SDK is already included in the <code>server</code> directory.</p>
<p>Once you have the PHP SDK downloaded and present on your web server copy and paste the following code into <code>/criticalmass/index.php</code>:</p>
<pre>
<code> &lt;?php
   require &apos;server/fb-php-sdk/facebook.php&apos;;

   $app_id = &apos;APP_ID&apos;;
   $app_secret = &apos;APP_SECRET&apos;;
   $app_namespace = &apos;APP_NAMESPACE&apos;;
   $app_url = &apos;https://apps.facebook.com/&apos; . $app_namespace . &apos;/&apos;;
   $scope = &apos;email,publish_actions&apos;;

   // Init the Facebook SDK
   $facebook = new Facebook(array(
     &apos;appId&apos;  =&gt; $app_id,
     &apos;secret&apos; =&gt; $app_secret,
   ));

   // Get the current user
   $user = $facebook-&gt;getUser();

   // If the user has not installed the app, redirect them to the Auth Dialog
   if (!$user) {
     $loginUrl = $facebook-&gt;getLoginUrl(array(
       &apos;scope&apos; =&gt; $scope,
       &apos;redirect_uri&apos; =&gt; $app_url,
     ));

     print(&apos;&lt;script&gt; top.location.href=\&apos;&apos; . $loginUrl . &apos;\&apos;&lt;/script&gt;&apos;);
   }
 ?&gt;
</code>
</pre>
<p>Make sure to enter in your App ID, App Secret and App Namespace on lines 25,26,27 respectively. You can get these values from the Basic Settings in the <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">Developer App</a>.</p>
<p>The code above walks through the following steps:</p>
<ul>
<li>Import the PHP SDK</li>
<li>Set a number of globals and use these to initialize the PHP SDK</li>
<li>Attempt to get the current user&apos;s User ID with <code>$user = $facebook-&gt;getUser();</code>. If the user has authorized the app, this would return their User ID. If they have not, it will return <code>0</code>
</li>
<li>If the User ID is 0 then create the Login URL. This Login URL utilizes the <a href="/docs/reference/dialogs/oauth/" name="https://developers.facebook.com/docs/reference/dialogs/oauth/">OAuth Dialog</a> to prompt the user to authorize the game.</li>
<li>Use a client side redirect to send the user to the <a href="/docs/reference/dialogs/oauth/" name="https://developers.facebook.com/docs/reference/dialogs/oauth/">OAuth Dialog</a>
</li>
</ul>
<p>In the Critical Mass example we ask for two additional <a href="/docs/authentication/permissions/" name="https://developers.facebook.com/docs/authentication/permissions/">permissions</a> via the <code>scope</code> parameter (lines 30 and 44): <code>publish_actions</code> and <code>email</code>. These are the primary permissions that most game developers need to implement Facebook Platform, specifically the <a href="/docs/score/" name="https://developers.facebook.com/docs/score/">Scores</a>, <a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements/">Achievements</a> and <a href="/docs/opengraph/" name="https://developers.facebook.com/docs/opengraph/">Open Graph</a> APIs.</p>
<p>An important note: since on Canvas our game is loaded into an iframe, we can&apos;t do a server side redirect here as we need to redirect the top frame. For this reason, we implement a client side redirect in JavaScript with <code>top.location</code>.</p>
<p>Finally once the user has authorized our app they will be redirected back to our Canvas URL. This is defined with the <code>redirect_uri</code> parameter (lines 29 and 45). If you omit this parameter the OAuth Dialog will default to your Canvas URL i.e. where your game is loaded from, not our Canvas Page URL at apps.facebook.com/NAMESPACE.</p>
<p>
<a name="step1b">
</a>  </p>
<h3>Step 1b - Authorization on Mobile Web</h3>
<p>Games that are loaded only on Mobile Web do not receive the <a href="/docs/authentication/signed_request/" name="https://developers.facebook.com/docs/authentication/signed_request/">Signed Request</a> parameter and as a result need to implement Authorization a little differently. For Critical Mass we will use <a href="/docs/authentication/client-side/" name="https://developers.facebook.com/docs/authentication/client-side/">client side Authorization</a> via the <a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">JavaScript SDK</a>.</p>
<p>Recall from <a href="/docs/guides/games/getting-started/#step0" name="https://developers.facebook.com/docs/guides/games/getting-started/#step0">Step 0</a> we set up a different end point for our Mobile Web URL in the <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">Developer App</a>. The result is that when viewing Critical Mass on a Mobile browser from the Facebook iOS, Android clients or the Mobile site this endpoint will be loaded. This allows us to create a customized interface and/or different initialization logic for a better mobile experience. The step is not necessary, you can use the same endpoint for both the Mobile and Canvas experiences if you would prefer.</p>
<p>First we will need to load the JavaScript SDK into our game. In <code>index.php</code> and <code>index_mobile.php</code> add the following code to load the SDK:</p>
<pre>
<code> &lt;!-- Load the Facebook JavaScript SDK --&gt;
 &lt;div id=&quot;fb-root&quot;&gt;&lt;/div&gt;
 &lt;script src=&quot;//connect.facebook.net/en_US/all.js&quot;&gt;&lt;/script&gt;
</code>
</pre>
<p>and then initialize the JavaScript SDK:</p>
<pre>
<code> &lt;script&gt;
   var appId = &apos;APP_ID&apos;;
   var uid;

   // Initialize the JS SDK
   FB.init({
     appId: appId,
     cookie: true,
   });

   // Get the user&apos;s UID
   FB.getLoginStatus(function(response) {
     uid = response.authResponse.userID ? response.authResponse.userID : null;
   });

   function authUser() {
     FB.login(function(response) {
       uid = response.authResponse.userID ? response.authResponse.userID : null;
     }, {scope:&apos;email,publish_actions&apos;});
   }
 &lt;/script&gt;
</code>
</pre>
<p>
<code>FB.init</code> is used to initialize the <a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">JavaScript SDK</a>. You only need to pass in your App ID, not your App Secret, which should never be stored client side. Next we attempt to retrive the User ID for the current user with <code>FB.getLoginStatus</code>. If <code>uid</code> was not set then the user has not authorized the game. Finally we create a new function called <code>authUser</code> that we can use to Authorize the user. When invoked this function will call <a href="/docs/reference/javascript/FB.login/" name="https://developers.facebook.com/docs/reference/javascript/FB.login/">FB.login</a> from the <a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">JavaScript SDK</a>. This will pop up a new window with the <a href="/docs/reference/dialogs/oauth/" name="https://developers.facebook.com/docs/reference/dialogs/oauth/">OAuth Dialog</a>.</p>
<p>Now that we have our Authorization code written the last thing we need to do is wire it up to Critical Mass. In our case, we want to make sure that users have authorized the game before they are eligible to play. Let&apos;s detect the user state in our &quot;Play&quot; button and if they have not authorized with Facebook, prompt them to do so.</p>
<p>
<img src="https://developers.facebook.com/attachment/cm_mobile_auth.jpg" />
</p>
<p>To do this we will edit <code>client/ui.js</code>. This is a set of JavaScript functions that draw the menus in Critical Mass. Clicking the &quot;Play&quot; button in our UI invokes <code>startGame()</code> so we can make our edits there.</p>
<pre>
<code> function startGame() {
   // If the user has connected to Facebook, let them play the game
   if(uid) {
     initGame();
     displayMenu(false);
   }
   else {
     authUser();
   }
 }
</code>
</pre>
<p>The code above checks to see if <code>uid</code> is set. If we have the User ID it then starts the game. If we do not, it will call our <code>authUser()</code> function which will prompt the user to authorize the game. As <a href="/docs/reference/javascript/FB.login/" name="https://developers.facebook.com/docs/reference/javascript/FB.login/">FB.login</a> will spawn a pop up window, it must be called as part of a user initiated click event, otherwise it will be caught by browser pop up blockers.</p>
<p>
<a name="step2">
</a>  </p>
<h2>Step 2 - Implement Invites with Requests</h2>
<p>Invites from friends are one of the primary way that games can generate traffic and acquire new users. Now that we have implemented authorization and loaded the <a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">JavaScript SDK</a> we can use these to add Invites to Critical Mass.</p>
<p>To implement this we will use the <a href="/docs/reference/dialogs/requests/" name="https://developers.facebook.com/docs/reference/dialogs/requests/">Request Dialog</a> and the <a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">JavaScript SDK</a>.</p>
<p>In our <code>client/ui.js</code> file let&apos;s create a new button in our Main Menu called &quot;Invite&quot;. To do this we will make a small update to the <code>createMenu</code> function on line 44:</p>
<pre>
<code> createButton(&apos;invite&apos;, &apos;sendInvite&apos;);
</code>
</pre>
<p>Next we will need to define our <code>sendInvite</code> function. At the bottom of <code>client/ui.js</code> add:</p>
<pre>
<code> function sendInvite() {
   // Use the Facebook JS SDK to open a Request MFS Dialog
   FB.ui({method: &apos;apprequests&apos;,
     title: &apos;Play Critical Mass with me!&apos;,
     message: &apos;Been having a blast playing Critical Mass, come check it out.&apos;,
   }, fbCallback);
 }
</code>
</pre>
<p>Our <code>sendInvite()</code> function implements <code>FB.ui</code> which allows us to display any Facebook <a href="/docs/reference/dialogs/" name="https://developers.facebook.com/docs/reference/dialogs/">Dialogs</a> within our app. For this example we will use the <a href="/docs/reference/dialogs/requests/" name="https://developers.facebook.com/docs/reference/dialogs/requests/">Request Dialog</a> to send Invite Requests to our friends. The <a href="/docs/reference/dialogs/requests/" name="https://developers.facebook.com/docs/reference/dialogs/requests/">Request Dialog</a> is specified in <code>FB.ui</code> with the <code>method</code> property &apos;apprequests&apos;. Next we enter in the titles of our Request and the message that will customize how the Request displays to our friends.</p>
<p>Next we need to do is implement a callback function. <code>FB.ui</code> will invoke a callback method when the user has finished interacting with a <a href="/docs/reference/dialogs/" name="https://developers.facebook.com/docs/reference/dialogs/">Dialog</a>. This can be used to determine the action the user took with the Dialog, in our case whether they completed sending a Request or if they canceled. First lets define our callback function:</p>
<pre>
<code> function fbCallback(response) {
   console.log(response);
 }
</code>
</pre>
<p>and then we pass <code>fbCallback</code> into our <code>FB.ui</code> call. You&apos;ll notice that all we are doing is getting the <code>response</code> object and then outputting this in the debug console. For a production app you may want to inspect the <code>response</code> object and take further action depending on the user&apos;s state, but in our case we&apos;ll just take a look at what the object looks like.</p>
<p>If the user sent a Request we will see:</p>
<p>
<img src="https://developers.facebook.com/attachment/request_success.jpg" />
</p>
<p>If the user canceled the Dialog response will be <code>undefined</code>.</p>
<p>For a full list of the parameters available check out the docs for the <a href="/docs/reference/dialogs/requests/" name="https://developers.facebook.com/docs/reference/dialogs/requests/">Request Dialog</a>, <a href="/docs/reference/dialogs/" name="https://developers.facebook.com/docs/reference/dialogs/">Dialog API</a> and <a href="/docs/reference/javascript/FB.ui/" name="https://developers.facebook.com/docs/reference/javascript/FB.ui/">FB.ui</a>.</p>
<p>At this point we have implemented sending Requests and users can send Invites to their friends. The last thing we need to do is allow users to accept these Requests. Requests that are send to users are <strong>not</strong> cleared automatically when a user clicks on them. Developers need to clear an outstanding Request when the user has completed the desired action. In our case our Requests are Invites so by navigating to Critical Mass the recipient user has completed our desired action. Let&apos;s clear the Request when a user arrives at Critical Mass by accepting a Request.</p>
<p>When a user accepts a Request via a notification or from the <a href="https://www.facebook.com/apps/center" name="https://www.facebook.com/apps/center" target="_blank">Games Dashboard</a> Facebook will pass the Request ID(s) to our <code>index.php</code> page. Let&apos;s clear these Requests using the PHP SDK for our Canvas version of Critical Mass:</p>
<pre>
<code> if(isset($_REQUEST[&apos;request_ids&apos;])) {
   $requestIDs = explode(&apos;,&apos; , $_REQUEST[&apos;request_ids&apos;]);
   foreach($requestIDs as $requestID) {
     try {
       $delete_success = $facebook-&gt;api(&apos;/&apos; . $requestID, &apos;DELETE&apos;);
     } catch(FacebookAPIException $e) {
       error_log($e);
     }
   }
 }
</code>
</pre>
<p>The code above will get the <code>request_ids</code> parameter and then split it on &apos;,&apos;, as this can be either a single Request ID or a comma delimited string of Request IDs. Next we use the Graph API via the <code>FB.api</code> method in the PHP SDK to delete each Request by sending a HTTP request like:</p>
<pre>
<code> DELETE https://graph.facebook.com/REQUEST_ID?access_token=USER_ACCESS_TOKEN
</code>
</pre>
<p>You will notice that we aren&apos;t actually passing in a User Access Token anywhere, this is because both the PHP SDK and JavaScript SDK do this automatically in <code>$facebook-&gt;api()</code> and <code>FB.api</code> respectively.</p>
<p>Critical Mass users can now send Invites to their friends and when their friends click on the Request notification will navigate to Critical Mass where the Request will be automatically cleared.</p>
<p>
<a name="step3">
</a>  </p>
<h2>Step 3 - Implement Bragging Stories with Feed</h2>
<p>Next we will implement Bragging stories into Critical Mass. This will allow users to post a message back to their Timeline about Critical Mass. In this story we&apos;ll also include their current score making our Feed Dialog look like:</p>
<p>
<img src="https://developers.facebook.com/attachment/cm_brag_post.jpg" />
</p>
<p>To implement this we will use the <a href="/docs/reference/dialogs/feed/" name="https://developers.facebook.com/docs/reference/dialogs/feed/">Feed Dialog</a> and the <a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">JavaScript SDK</a>.</p>
<p>First let&apos;s create a new button in our Main Menu as we did for Invites. We insert a new line at line number 45:</p>
<pre>
<code> createButton(&apos;brag&apos;, &apos;sendBrag&apos;);
</code>
</pre>
<p>Next we will define our <code>sendBrag()</code> function:</p>
<pre>
<code> function sendBrag() {
   var messageStr = &apos;I just reached &apos; + gFinalScore + &apos; in Critical Mass!&apos;;

   FB.ui({ method: &apos;feed&apos;,
     caption: messageStr,
     name: &apos;Play Critical Mass Now&apos;,
     picture: &apos;IMAGE_URL&apos;,
     link: &apos;CANVAS_PAGE_URL&apos;
   }, fbCallback);
 }
</code>
</pre>
<p>To invoke the <a href="/docs/reference/dialogs/feed/" name="https://developers.facebook.com/docs/reference/dialogs/feed/">Feed Dialog</a> we will use <code>FB.ui</code> again, this time setting the <code>method</code> property to &apos;feed&apos;. For our basic Feed post we will also include a few additional parameters to make the story more interesting:</p>
<ul>
<li>caption - this is developer specific string that will appear under the user defined message</li>
<li>link - this is a URL that will be included in our story</li>
<li>name - optional, will set the display string for our link. If omitted the URL will be used</li>
<li>picture - a URL to an image that will be included in our story</li>
</ul>
<p>Finally we will use the same callback function <code>fbCallback</code> that we used for our Invites example in <a href="/docs/guides/games/getting-started/#step2" name="https://developers.facebook.com/docs/guides/games/getting-started/#step2">Step 2</a>. The output of a successful Feed post looks like:</p>
<p>
<img src="https://developers.facebook.com/attachment/feed_success.jpg" />
</p>
<p>You will noticed that we received a <code>post_id</code> property in the response. This represents the successful Feed story that was published.</p>
<p>For a full list of the parameters available check out the docs for the <a href="/docs/reference/dialogs/feed/" name="https://developers.facebook.com/docs/reference/dialogs/feed/">Feed Dialog</a>, <a href="/docs/reference/dialogs/" name="https://developers.facebook.com/docs/reference/dialogs/">Dialog API</a> and <a href="/docs/reference/javascript/FB.ui/" name="https://developers.facebook.com/docs/reference/javascript/FB.ui/">FB.ui</a>.</p>
<p>
<a name="step4">
</a>  </p>
<h2>Step 4 - Implement the Scores API</h2>
<p>Now that we have the Social Channels taken care of we can start implementing our Scoring feature. This will utilize the Facebook <a href="/docs/score/" name="https://developers.facebook.com/docs/score/">Scores API</a> to publish scores back to Facebook. In doing Facebook will start publishing High Score and Passing stories for our game, Critical Mass, based on the user scores that are submitted.</p>
<p>
<img src="https://developers.facebook.com/attachment/cm_high_score.jpg" width="516" />
</p>
<p>
<img src="https://developers.facebook.com/attachment/cm_passing.jpg" width="516" />
</p>
<p>The Game APIs, <a href="/docs/score/" name="https://developers.facebook.com/docs/score/">Scores</a> and <a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements/">Achievements</a>, can only be used by Apps that have categorized themselves as Games. To do this, go into Basic Settings in the <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">Developer App</a> and make sure your category is set to &apos;Games&apos;.</p>
<p>Next we will be using the <a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api/">Graph API</a> to POST a user score. Two important note when using the <a href="/docs/score/" name="https://developers.facebook.com/docs/score/">Scores</a> and <a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements/">Achievements</a> APIs:</p>
<ol>
<li>They require the <code>publish_actions</code> permission which we should already have as part of <a href="/docs/guides/games/getting-started/#step1" name="https://developers.facebook.com/docs/guides/games/getting-started/#step1">Step 1. Authorization</a>.</li>
<li>They require the use of an <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Token</a>. This is to ensure that the originator of the POST is our game, Critical Mass</li>
</ol>
<p>As <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Tokens</a> are built off the Games client secret, which is a shared secret between Facebook and the app, these should not be stored client side to protect their integrity. We will keep our <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Token</a> on our web server and write a small PHP script that will POST scores for Critical Mass.</p>
<p>The PHP script has been included in <a href="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" name="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" target="_blank">criticalmasscomplete</a> at <code>server/savescore.php</code>. Let&apos;s walk through what this code does:</p>
<pre>
<code> &lt;?php
     require &apos;fb-php-sdk/facebook.php&apos;;

     $app_id = &apos;APP_ID&apos;;
     $app_secret = &apos;APP_SECRET&apos;;
     $score = $_REQUEST[&apos;score&apos;];

     $facebook = new Facebook(array(
       &apos;appId&apos;  =&gt; $app_id,
       &apos;secret&apos; =&gt; $app_secret,
     ));

     $user = $facebook-&gt;getUser();

     $app_access_token = get_app_access_token($app_id, $app_secret);
     $facebook-&gt;setAccessToken($app_access_token);
     $response = $facebook-&gt;api(&apos;/&apos; . $user . &apos;/scores&apos;, &apos;post&apos;, array(
       &apos;score&apos; =&gt; $score,
     ));
     print($response);

     // Helper function to get an APP ACCESS TOKEN
     function get_app_access_token($app_id, $app_secret) {
       $token_url = &apos;https://graph.facebook.com/oauth/access_token?&apos;
         . &apos;client_id=&apos; . $app_id
         . &apos;&amp;client_secret=&apos; . $app_secret
         . &apos;&amp;grant_type=client_credentials&apos;;

       $token_response =file_get_contents($token_url);
       $params = null;
       parse_str($token_response, $params);
       return  $params[&apos;access_token&apos;];
     }
 ?&gt;
</code>
</pre>
<p>The script expects a parameter <code>score</code>, the user&apos;s current score, which will be passed in via our game client.</p>
<p>First we initialize the <a href="/docs/reference/php/" name="https://developers.facebook.com/docs/reference/php/">PHP SDK</a> similar to <a href="/docs/guides/games/getting-started/#step1a" name="https://developers.facebook.com/docs/guides/games/getting-started/#step1a">Step 1a</a>.</p>
<p>Next we retrieve our <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Token</a>. To do this we created a simple function <code>get_app_access_token</code> that will request this from the <a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api/">Graph API</a>. For more information on this step, check out this <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">doc</a>.</p>
<p>Once we have our <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Token</a> we then set this token in the PHP SDK with <code>$facebook-&gt;setAccessToken($app_access_token)</code>, as mentioned previously the Facebook SDKs default to using User Access Tokens.</p>
<p>Finally we POST the score against the <a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api/">Graph API</a>, the request looks like:</p>
<pre>
<code> POST https://graph.facebook.com/USER_ID/scores
   score=1337
   access_token=APP_ACCESS_TOKEN
</code>
</pre>
<p>The last step is then sending our score from the Critical Mass client to our new <code>savescore.php</code> script. Let&apos;s update the <code>saveScore()</code> function in <code>client/game.js</code> at line 201:</p>
<pre>
<code> function saveScore() {
   gFinalScore = gLevel * 15;

    $.ajax({
     type: &apos;POST&apos;,
     async: false,
     url: &apos;server/savescore.php&apos; + &apos;?score=&apos; + gFinalScore,
     success: function(response) {
       console.log(response);
       if(response == &apos;0&apos;)
         alert(&apos;Error saving score!&apos;);
     }
   });     
 }
</code>
</pre>
<p>In the code above we use JQuery to make an simple HTTP request back to <code>savescore.php</code> passing our <code>score</code> in the query string. On complete we check the the response for a true/false state and if false <code>alert</code> out an error to the user.</p>
<p>To test this we can play a single game of Critical Mass to generate and save our score. If we received a High Score we can confirm the story in our Timeline Activity Log at <a href="https://www.facebook.com/USER_ID/allactivity" name="https://www.facebook.com/USER_ID/allactivity" target="_blank">https://www.facebook.com/USER_ID/allactivity</a>:</p>
<p>
<img src="https://developers.facebook.com/attachment/cm_activity_log.jpg" width="634" />
</p>
<p>
<a name="step5">
</a>  </p>
<h2>Step 5 - Load a leaderboard with the Facebook Scores API</h2>
<p>Our next step is to add a leaderboard to Critical Mass that will read in the scores we published with <a href="/docs/guides/games/getting-started/#step4" name="https://developers.facebook.com/docs/guides/games/getting-started/#step4">Step 4</a>. We will read back our leaderboard from the <a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api/">Graph API</a> with:</p>
<pre>
<code> GET https://graph.facebook.com/APP_ID/scores?access_token=USER_ACCESS_TOKEN
</code>
</pre>
<p>As this case is a read we don&apos;t need to use our <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Token</a> and can use our User Access Token.</p>
<p>First let&apos;s request our scores via the JavaScript SDK. In <code>client/ui.js</code> we can define a new function called <code>leaderboardInit</code>:</p>
<pre>
<code> function leaderboardInit() {
   FB.api(&apos;/&apos; + appId + &apos;/scores&apos;, function(response) {
     createLeaderboard(response.data)
   });
 }
</code>
</pre>
<p>This function will request the Graph API endpoint we described above via the <a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">FB.api</a>. As stated previously, this will include our User Access Token for us. If we <code>console.log</code> the <code>response</code> object it should look like:</p>
<p>
<img src="https://developers.facebook.com/attachment/leaderboard_success.jpg" width="438" />
</p>
<p>We then pass this array into <code>createLeaderboard()</code> which will iterate through the array and construct our leaderboard. Note this function is already included for you in <a href="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" name="https://github.com/fbsamples/CriticalMass/tree/master/web/criticalmass" target="_blank">criticalmass</a> in <code>client/ui.js</code>, line 85.</p>
<p>The final result will look like:</p>
<p>
<img src="https://developers.facebook.com/attachment/cm_leaderboard.jpg" width="294" />
</p>
<p>
<a name="step6">
</a>  </p>
<h2>Step 6 - Implement the Facebook Achievements API</h2>
<p>In our final step we will add support for Facebook Achievements into Critical Mass. We&apos;ll create a new Achievement called &apos;3 Ball Combo&apos; that is unlocked the first time a user destroys 3 balls with a single explosion. Once earned, users will see a story that looks like:</p>
<p>
<img src="https://developers.facebook.com/attachment/achievement_story.jpg" width="509" />
</p>
<p>Adding achievements into Critical Mass will take a few simple steps. The first thing to keep in mind is that the <a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements">Achievements API</a> is built on <a href="/docs/opengraph/" name="https://developers.facebook.com/docs/opengraph/">Open Graph</a> and utilizes the Achieve Built In action. As with all Open Graph actions we will first need to create our Achievement Object. This will represent the achievement that users can earn in Critical Mass. You can find the prebuilt achievement object for &apos;3 Ball Combo&apos; in <code>/criticalmass/server/goldmedal.php</code>.</p>
<p>Facebook Achievements employ a points system similar to achievement systems on other platforms. A single App ID has 1000 points that they can spend on their achievements, awarding as many or as little of their points to any single achievement. In our case, we will set our points to 50 for &apos;3 Ball Combo&apos;. For more information about the points system check out the <a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements/">Achievement API docs</a>.</p>
<p>Let&apos;s take a look at our Achievement object:</p>
<pre>
<code> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;
    &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;

 &lt;head&gt;
   &lt;meta property=&quot;og:title&quot; content=&quot;3 Ball Combo&quot; /&gt;
   &lt;meta property=&quot;og:type&quot; content=&quot;game.achievement&quot; /&gt;
   &lt;meta property=&quot;game:points&quot; content=&quot;50&quot; /&gt;
   &lt;meta property=&quot;og:image&quot; content=&quot;http://DOMAIN_NAME/criticalmasscomplete/server/goldmedal.png&quot; /&gt;
   &lt;meta property=&quot;og:description&quot; content=&quot;Gold Medal - destroy 3 balls with a single explosion!&quot; /&gt;
   &lt;meta property=&quot;og:url&quot; content=&quot;http://DOMAIN_NAME/criticalmasscomplete/server/goldmedal.php&quot; /&gt;
   &lt;meta property=&quot;fb:app_id&quot; content=&quot;APP_ID&quot; /&gt;
 &lt;/head&gt;
 &lt;body&gt;

   &lt;div style=&quot;text-align:center; width:500px; margin:0px auto;&quot;&gt;
     &lt;img src=&apos;http://DOMAIN_NAME/criticalmasscomplete/server/goldmedal.png&apos; /&gt;
     &lt;div&gt;Gold Medal - destroy 3 balls with a single explosion!&lt;/div&gt;
     &lt;div&gt;&lt;a href=&quot;https://apps.facebook.com/APP_NAMESPACE/&quot;&gt;Play Critical Mass Now!&lt;/a&gt;&lt;div&gt;
   &lt;/div&gt;  

 &lt;/body&gt;
 &lt;/html&gt;
</code>
</pre>
<p>Once this file is uploaded to our web server, we will want to validate that we&apos;ve set everything up correctly. You can do this by navigating to the <a href="https://developers.facebook.com/tools/debug/" name="https://developers.facebook.com/tools/debug/" target="_blank">Debug Tool</a> and entering the URL to the page we just created. If everything is correct you should see no errors.</p>
<p>
<img src="https://developers.facebook.com/attachment/achievement_debugged.jpg" width="592" />
</p>
<p>Next we will need to register our achievement for Critical Mass. The <a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements/">Achievements API</a> is a unique from other Open Graph actions as it requires a registration step before achievements can be earned. To register our achievement we will need to make a one time call against the Graph API. Since this only needs to be done once per achievement we can make the call over curl or the <a href="https://developers.facebook.com/tools/explorer" name="https://developers.facebook.com/tools/explorer" target="_blank">Graph API Explorer</a> and keep things simple.</p>
<p>The POST request will be made against the <code>graph.facebook.com/APP_ID/achievements</code> endpoint and pass in the <code>achievement</code> (the URL of our object) and the <code>display_order</code> (the order in which achievements should be display in the Facebook UI, sorted from easiest to achieve to hardest) parameters with an <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Token</a>.</p>
<pre>
  curl -F &apos;achievement=http://DOMAIN_NAME/criticalmasscomplete/server/goldmedal.php&apos;
       -F &apos;display_order=1&apos;
       -F &apos;access_token=APP_ACCESS_TOKEN&apos;
       &apos;https://graph.facebook.com/APP_ID/achievements&apos;
</pre>
<p>This will return <code>true</code> when the achievement is registered successfully.</p>
<p>At this point our achievement is ready for use and we will need to wire up Critical Mass to support it. Let&apos;s consider the criteria for earning &apos;3 Ball Combo&apos;:</p>
<ul>
<li>A user must destroy at least three balls with one explosion.</li>
<li>A user can only earn &apos;3 Ball Combo&apos; once.</li>
</ul>
<p>To implement this we will need to add two checks to Critical Mass:</p>
<ol>
<li>Is the user eligible to earn the &apos;3 Ball Combo&apos; (have they already earned it).</li>
<li>Did the user destroy greater than 2 balls per explosion.</li>
</ol>
<p>For the first condition we will use the Graph API to check if the user has &apos;3 Ball Combo&apos; or not. In <code>client/game.js</code> we will create a new boolean called <code>gIsPlayerEligibleForAchievement</code>. This will keep state on whether the user is eligible or not.</p>
<pre>
<code> var gIsPlayerEligibleForAchievement = true;
</code>
</pre>
<p>Next let&apos;s add a new function called <code>getAchievements</code>:</p>
<pre>
<code> function getAchievements() {
   FB.api(&apos;/me/achievements&apos;, function(response) {
     for(var i = 0; i &lt; response.data.length; i++) {
       if(response.data[i].achievement.title == &apos;3 Ball Combo&apos;) {
         gIsPlayerEligibleForAchievement = false;
         break;
       }
     }

     console.log(&apos;Player Eligible for 3 Ball Combo: &apos; + gIsPlayerEligibleForAchievement);
   });
 }
</code>
</pre>
<p>This function will get the list of achievements the user has already earned via the Graph API and then loop through them checking for one titled &apos;3 Ball Combo&apos;. If it finds the achievement it will set our flag <code>gIsPlayerEligibleForAchievement</code> to <code>false</code>.</p>
<p>Next we will update <code>client/core.js</code> at line 47 and include a call to <code>getAchievements();</code> which will results in Critical Mass checking the eligibility of the player on load.</p>
<p>Now that this is in place we will need to test for the second condition: did the user destroy 3 balls with one explosion. In <code>client/game.js</code> let&apos;s add two new functions called <code>checkIfAchievement</code> and <code>saveAchievement</code>:</p>
<pre>
<code> function checkIfAchievement() {
   if(gCirclesDestroyed &gt; 2 &amp;&amp; gIsPlayerEligibleForAchievement) {
     saveAchievement();
   }
 }

 function saveAchievement() {
   $.ajax({
     type: &apos;POST&apos;,
     async: true,
     url: &apos;server/saveachievement.php&apos;,
     success: function(response) {
       console.log(response);
       if(response == &apos;0&apos;) {
         alert(&apos;Error saving achievement!&apos;);
       } else {
         console.log(&apos;Saved Achievement&apos;);
         gIsPlayerEligibleForAchievement = false;
       }
     }
   });
 }
</code>
</pre>
<p>and at line 307 in <code>client/game.js</code> we will call <code>checkIfAchievement</code>
</p>
<pre>
<code>if (this.destroyed == false) {
  gCirclesDestroyed += 1;
  checkIfAchievement();
}
</code>
</pre>
<p>The code we just wrote will now check each time a user makes an explosion to see if greater than 2 balls were hit. It will also check to see if the user is eligible to earn our achievement. If both of these conditions have been met it will then call <code>saveAchievement</code> to POST the achievement for the user.</p>
<p>You will notice that <code>saveAchievement</code> calls a PHP script at <code>server/saveachievement.php</code>. This script is very similar to the <code>savescore.php</code> we added in <a href="/docs/guides/games/getting-started/#step4" name="https://developers.facebook.com/docs/guides/games/getting-started/#step4">Step 4</a>. The <a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements/">Achievements API</a> has the same restriction as the <a href="/docs/score/" name="https://developers.facebook.com/docs/score">Scores API</a> - it can only be used with an <a href="/docs/authentication/applications/" name="https://developers.facebook.com/docs/authentication/applications/">Application Access Token</a>:</p>
<pre>
<code> &lt;?php
     require &apos;fb-php-sdk/facebook.php&apos;;

     $app_id = &apos;APP_ID&apos;;
     $app_secret = &apos;APP_SECRET&apos;;

     $facebook = new Facebook(array(
       &apos;appId&apos;  =&gt; $app_id,
       &apos;secret&apos; =&gt; $app_secret,
     ));

     $user = $facebook-&gt;getUser();

     $app_access_token = get_app_access_token($app_id, $app_secret);
     $facebook-&gt;setAccessToken($app_access_token);

     try {
       $response = $facebook-&gt;api(&apos;/&apos; . $user . &apos;/achievements&apos;, &apos;post&apos;, array(
         &apos;achievement&apos; =&gt; &apos;http://www.bitdecay.net/labs/criticalmasscomplete/server/goldmedal.php&apos;,
       ));
       print($response);
     } catch(FacebookAPIException $e) {
       error_log($e);
       print(0);
     }

     // Helper function to get an APP ACCESS TOKEN
     function get_app_access_token($app_id, $app_secret) {
       $token_url = &apos;https://graph.facebook.com/oauth/access_token?&apos;
         . &apos;client_id=&apos; . $app_id
         . &apos;&amp;client_secret=&apos; . $app_secret
         . &apos;&amp;grant_type=client_credentials&apos;;

       $token_response =file_get_contents($token_url);
       $params = null;
       parse_str($token_response, $params);
       return  $params[&apos;access_token&apos;];
     }
 ?&gt;
</code>
</pre>
<p>Now Critical Mass is all set to start awarding achievements to users. Play the game and try to hit 3 balls or more with a single explosion. If successful, checking your Timeline Activity Log will display:</p>
<p>
<img src="https://developers.facebook.com/attachment/achievement_activity_log.jpg" width="667" />
</p>
<p>
<a name="step7">
</a>  </p>
<h2>Step 7 - Create an App Detail page for App Center</h2>
<p>Critical Mass is now fully integrated with Facebook platform and includes a number of exciting social features. To help improve distribution for Critical Mass we should also create an App Detail page in App Center. This will allow Critical Mass to be listed in the App Center and help new users discover our great game. Fortunately creating an app detail page and submitting it for review is a straightforward process. Please refer to the <a href="/docs/guides/appcenter/" name="https://developers.facebook.com/docs/guides/appcenter">App Center Tutorial</a> for a complete walkthrough.</p>
<p>That concludes the Getting Started Steps for Game Developers. Most importantly all of the steps we walked through above work the same for both Mobile Web and Canvas. The finished game Critical Mass is now playable on a mobile phone browser, on Facebook Canvas and displayed in the <a href="/docs/appcenter/" name="https://developers.facebook.com/docs/appcenter">App Center</a>.</p>
<hr />
<h2>Appendix</h2>
<p>Below is a list of the technologies we used to integrate Critical Mass with the Facebook Platform for both Canvas and Mobile Web:</p>
<ul>
<li>
<a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api/">Graph API</a>
</li>
<li>
<a href="/docs/reference/dialogs/" name="https://developers.facebook.com/docs/reference/dialogs/">Dialogs</a>
</li>
<ul>
<li>
<a href="/docs/reference/dialogs/oauth/" name="https://developers.facebook.com/docs/reference/dialogs/oauth/">OAuth</a>
</li>
<li>
<a href="/docs/reference/dialogs/requests/" name="https://developers.facebook.com/docs/reference/dialogs/requests/">Request</a>
</li>
<li>
<a href="/docs/reference/dialogs/feed/" name="https://developers.facebook.com/docs/reference/dialogs/feed/">Feed</a>
</li>
</ul>
<li>
<a href="/docs/score/" name="https://developers.facebook.com/docs/score/">Scores</a>
</li>
<li>
<a href="/docs/achievements/" name="https://developers.facebook.com/docs/achievements/">Achievements</a>
</li>
<li>
<a href="/docs/guides/appcenter/" name="https://developers.facebook.com/docs/guides/appcenter/">App Center</a>
</li>
<li>
<a href="/docs/reference/php/" name="https://developers.facebook.com/docs/reference/php/">PHP SDK</a>
</li>
<li>
<a href="/docs/reference/javascript/" name="https://developers.facebook.com/docs/reference/javascript/">JavaScript SDK</a>
</li>
</ul>
<p>For more information of Games best practices check out the <a href="/docs/guides/games/" name="https://developers.facebook.com/docs/guides/games/">Games Tutorial</a>, <a href="/docs/fluidcanvas/" name="https://developers.facebook.com/docs/fluidcanvas/">Fluid Canvas</a> and <a href="/docs/appsonfacebook/tutorial/" name="https://developers.facebook.com/docs/appsonfacebook/tutorial/">Canvas docs</a>.</p>
<div class="mtl pvm uiBoxWhite topborder">
<div class="mbm lfloat">
<fb:like href="http://developers.facebook.com/docs/guides/games/getting-started/" send="true" show_faces="false">
</fb:like>
</div>
<div class="clear">
<abbr class="timestamp" data-utime="1338309790" title="2012年5月29日 9:43">2012年5月29日 9:43</abbr>
</div>
</div></div>

</body>
</html>
