<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>https://developers.facebook.com/docs/opengraph/actionlinks/</title>
<link rel="stylesheet" href="/css/common.css" media="screen" />
<script src="/js/common.js"></script>
</head>
<body>
<a id="oklahomer-orig-url" href="https://developers.facebook.com/docs/opengraph/actionlinks/">https://developers.facebook.com/docs/opengraph/actionlinks/</a>

<div id="oklahomer-menu-wrapper">
<div class="toplevelnav">
<ul>
<li>
<a href="/docs/" name="https://developers.facebook.com/docs/">
<div class="navSectionTitle">Getting Started</div>
</a>
</li>
<li class="active withsubsections">
<a class="selected" href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts">
<div class="navSectionTitle">Core Concepts</div>
</a>
<ul class="subsections">
<li>
<a href="https://developers.facebook.com/socialdesign" name="https://developers.facebook.com/socialdesign" target="_blank">Social Design</a>
</li>
<li>
<a href="/docs/plugins/" name="https://developers.facebook.com/docs/plugins">Social Plugins</a>
</li>
<li>
<a href="/docs/opengraph/" name="https://developers.facebook.com/docs/opengraph">Open Graph</a>
</li>
<li>
<a href="/docs/channels/" name="https://developers.facebook.com/docs/channels">Social Channels</a>
</li>
<li>
<a href="/docs/authentication/" name="https://developers.facebook.com/docs/authentication">Authentication</a>
</li>
<li>
<a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api">Graph API</a>
</li>
</ul>
</li>
<li>
<a href="/docs/advancedtopics/" name="https://developers.facebook.com/docs/advancedtopics">
<div class="navSectionTitle">Advanced Topics</div>
</a>
</li>
<li>
<a href="/docs/sdks/" name="https://developers.facebook.com/docs/sdks">
<div class="navSectionTitle">SDK Reference</div>
</a>
</li>
<li>
<a href="https://developers.facebook.com/tools" name="https://developers.facebook.com/tools" target="_blank">
<div class="navSectionTitle">Tools</div>
</a>
</li>
</ul>
</div>
<ul id="navsubsectionpages">
<li>
</li>
<li>
<h5>Getting Started</h5>
<ul>
<li>
<a href="/docs/opengraph/keyconcepts/" name="http://developers.facebook.com/docs/opengraph/keyconcepts/">Key Concepts</a>
</li>
<li>
<a href="/docs/opengraph/tutorial/" name="http://developers.facebook.com/docs/opengraph/tutorial/">Tutorial</a>
</li>
<li>
<a href="/docs/opengraph/authentication/" name="http://developers.facebook.com/docs/opengraph/authentication/">Auth Dialog</a>
</li>
<li>
<a href="/docs/opengraph/plugins/" name="http://developers.facebook.com/docs/opengraph/plugins/">Social Plugins</a>
</li>
<li>
<a href="/docs/opengraph/samples/" name="http://developers.facebook.com/docs/opengraph/samples/">Open Graph Samples</a>
</li>
</ul>
</li>
<li>
<h5>Open Graph Tool</h5>
<ul>
<li>
<a href="/docs/opengraph/define-objects/" name="http://developers.facebook.com/docs/opengraph/define-objects/">Define Objects</a>
</li>
<li>
<a href="/docs/opengraph/define-actions/" name="http://developers.facebook.com/docs/opengraph/define-actions/">Define Actions</a>
</li>
<li>
<a href="/docs/opengraph/define-units/" name="http://developers.facebook.com/docs/opengraph/define-units/">Define Aggregations</a>
</li>
<li>
<a href="/docs/opengraph/opengraph-approval/" name="http://developers.facebook.com/docs/opengraph/opengraph-approval/">Submit for Approval</a>
</li>
<li>
<a href="/docs/opengraph/template/" name="http://developers.facebook.com/docs/opengraph/template/">Using Text Templates</a>
</li>
</ul>
</li>
<li>
<h5>Reference</h5>
<ul>
<li>
<a href="/docs/opengraph/objects/" name="http://developers.facebook.com/docs/opengraph/objects/">Using Objects</a>
</li>
<li>
<a href="/docs/opengraph/actions/" name="http://developers.facebook.com/docs/opengraph/actions/">Using Actions</a>
</li>
<li>
<a href="/docs/opengraph/permissions/" name="http://developers.facebook.com/docs/opengraph/permissions/">Open Graph Permissions</a>
</li>
<li>
<a href="/docs/opengraph/objects/builtin/" name="http://developers.facebook.com/docs/opengraph/objects/builtin/">Built-in Object Types</a>
</li>
<li>
<a href="/docs/opengraph/actions/builtin/" name="http://developers.facebook.com/docs/opengraph/actions/builtin/">Built-in Action Types</a>
</li>
<li>
<a href="/docs/opengraph/simpletypes/" name="http://developers.facebook.com/docs/opengraph/simpletypes/">Simple Types</a>
</li>
<li>
<a href="/docs/opengraph/complextypes/" name="http://developers.facebook.com/docs/opengraph/complextypes/">Complex Types</a>
</li>
<li>
<a href="/docs/opengraph/checklist/" name="http://developers.facebook.com/docs/opengraph/checklist/">Open Graph Checklist</a>
</li>
<li>
<a href="/docs/opengraph/publish-past-actions/" name="http://developers.facebook.com/docs/opengraph/publish-past-actions/">Publishing Past Actions</a>
</li>
<li>
<a href="/docs/opengraph/usergeneratedphotos/" name="http://developers.facebook.com/docs/opengraph/usergeneratedphotos/">User Generated Photos in Open Graph</a>
</li>
</ul>
</li>
<li class="active">
<h5>Advanced</h5>
<ul>
<li>
<a href="/docs/opengraph/internationalization/" name="http://developers.facebook.com/docs/opengraph/internationalization/">Open Graph Internationalization</a>
</li>
<li>
<a class="selected" href="/docs/opengraph/actionlinks/" name="http://developers.facebook.com/docs/opengraph/actionlinks/">Action Links</a>
</li>
<li>
<a href="/docs/opengraph/insights/" name="http://developers.facebook.com/docs/opengraph/insights/">Open Graph Insights</a>
</li>
<li>
<a href="/docs/opengraph/userrestrictions/" name="http://developers.facebook.com/docs/opengraph/userrestrictions/">User Restrictions</a>
</li>
<li>
<a href="/docs/opengraph/using-app-tokens/" name="http://developers.facebook.com/docs/opengraph/using-app-tokens/">Using App Access Tokens</a>
</li>
</ul>
</li>
<li>
<h5>Archive</h5>
<ul>
<li>
<a href="/docs/opengraphprotocol/" name="http://developers.facebook.com/docs/opengraphprotocol/">Open Graph Protocol</a>
</li>
</ul>
</li>
</ul></div>

<div id="oklahomer-content-wrapper">
<div class="header">
<div class="content">
<h1>Action Links</h1>
<div class="breadcrumbs">
<a href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts/">Core Concepts</a> › <a href="/docs/opengraph/" name="https://developers.facebook.com/docs/opengraph/">Open Graph</a> › <a href="/docs/opengraph/actionlinks/" name="https://developers.facebook.com/docs/opengraph/actionlinks/">Action Links</a>
</div>
</div>
</div>
<p>Open Graph <strong>Actions</strong> are the high-level &quot;interactions&quot; users can perform in your app. When these actions are published, the activities may appear in a users&apos; Timeline or their friends&apos; News Feeds and Ticker. Open Graph <strong>Action Links</strong> show up alongside the Like and Comment actions in any Open Graph story allowing friends to quickly take action in response to a story without having to navigate away from that story. This in turn will drive more distribution to your app with fewer user clicks.</p>
<p>
<strong>Story with Action Link:</strong>
</p>
<p style="text-align:center">
<img src="https://developers.facebook.com/attachment/action_links_example_action2.png/" style="border: 1px solid #000000" />
</p>
<p>
<strong>Story after Action Link Clicked:</strong>
</p>
<p style="text-align:center">
<img src="https://developers.facebook.com/attachment/action_links_example_friendreact.png/" style="border: 1px solid #000000" />
</p>
<p>
<strong>NOTE:</strong> You cannot cross-promote or advertise any content with action links.</p>
<p>Action Links can be configured for a <a href="/docs/opengraph/actions/builtin/" name="https://developers.facebook.com/docs/opengraph/actions/builtin/">built-in action type</a> or a custom action type. When the user takes the action, you should then publish a story against that action. The resulting Action Link story may be seen in the user&apos;s Timeline, on their friends&apos; News Feed and Ticker.</p>
<p>Note that at this time action links are currently not available in mobile.</p>
<p>In this document we will cover the following:</p>
<ul>
<li>
<a href="/docs/#howitworks" name="https://developers.facebook.com/docs/#howitworks">How It Works</a>: Detailed steps to show the action links flow.</li>
<li>
<a href="/docs/#config" name="https://developers.facebook.com/docs/#config">Configuration</a>: Configuring the action link association.</li>
<li>
<a href="/docs/#test" name="https://developers.facebook.com/docs/#test">Testing Your Implementation</a>: Pointers on how to best debug your action links implementation.</li>
<li>
<a href="/docs/#faq" name="https://developers.facebook.com/docs/#faq">Frequently Asked Questions</a>: Frequently asked questions and further debugging tips.</li>
<li>
<a href="/docs/#code" name="https://developers.facebook.com/docs/#code">Sample Code</a>: Sample code for an action link endpoint</li>
</ul>
<hr />
<h2 id="howitworks">How It Works</h2>
<p>We will walk through an example flow to demonstrate how action links work and highlight the integration points.</p>
<h3>Example Flow</h3>
<p>The example flow we will use is based on a cooking app that allows users to &quot;cook a recipe&quot;. Here is an example flow for how an action link can be triggered and processed:</p>
<ol>
<li>User 1 takes an action on the app to say that they &quot;cooked a recipe&quot;. The app allows users to also &quot;save&quot; recipes, the &quot;cook&quot; action is configured to have an associated action link of &quot;save&quot;. This is due to the fact that a user can cook a recipe and save a recipe.</li>
<li>User 2 sees the story that User 1 &quot;cooked a recipe&quot;. In that story, at the bottom next to the &quot;Like&quot; and &quot;Comment&quot; they also see, &quot;Save This Recipe&quot;. </li>
<li>
<p>When User 2 clicks on &quot;Save This Recipe&quot;, Facebook will check if the user has installed the app or not.</p>
<ul>
<li>
<p>If the user has installed the app: Facebook will make a server-to-server call to the https:// endpoint specified in the <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">App Dashboard</a> for that action link. The call will contain a <code>signed_request</code> parameter with a payload that includes the following data:</p>
<ul>
<li>A valid access_token for User 2.</li>
<li>The user Id for User 2.</li>
<li>The action type in the form &lt;APP_NAMESPACE&gt;:&lt;ACTION&gt;.</li>
<li>The action Id (optional).</li>
<li>The object URL.</li>
<li>
<p>A sample <code>signed_request</code> is shown below:</p>
<pre>
<code>  {
     &quot;objects&quot;: [
        {
           &quot;url&quot;: &quot;http:\/\/www.sugarmedia.com\/nyccookbook\/pizza.html&quot;
        }
     ],
     &quot;action_link&quot;: {
        &quot;type&quot;: &quot;nyccookbook:save&quot;
     },
     &quot;actions&quot;: [
        {
           &quot;id&quot;: &quot;3936222850404&quot;
        }
     ],
     &quot;algorithm&quot;: &quot;HMAC-SHA256&quot;,
     &quot;expires&quot;: 1335830400,
     &quot;issued_at&quot;: 1335823862,
     &quot;oauth_token&quot;: &quot;12345678901234567890&quot;,
     &quot;user&quot;: {
        &quot;country&quot;: &quot;us&quot;,
        &quot;locale&quot;: &quot;en_US&quot;
     },
     &quot;user_id&quot;: &quot;621273&quot;
  }
</code>
</pre>
</li>
</ul>
</li>
<li>
<p>If the user has not installed the app: The user will be redirected based on whether <a href="/docs/opengraph/authentication/#referrals" name="https://developers.facebook.com/docs/opengraph/authentication/#referrals">Authenticated Referrals</a> are enabled for your app:</p>
<ul>
<li>If enabled, the permissions dialog will be displayed to allow the user to install your app. After the app is installed the user will be redirected to the object URL.</li>
<li>If disabled, the user will be redirected to the object URL.</li>
<li>When directed to the object URL, the following data will be provided: <ul>
<li>The action Id in the <code>fb_action_ids</code> parameter.</li>
<li>The action type in the form &lt;APP_NAMESPACE&gt;:&lt;ACTION&gt; in the <code>fb_action_link_type</code> parameter.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>The endpoint configured to handle the action link can return one of two messages:</p>
<ul>
<li>
<p>&quot;success=&gt;true&quot;:</p>
<pre>
<code>      {
          &quot;success&quot;:&quot;true&quot;
      }
</code>
</pre>
</li>
<li>
<p>&quot;redirect=&gt;&lt;some url&gt;&quot;: Example</p>
<pre>
<code>      {
          &quot;redirect&quot;:&quot;http:\/\/www.example.com\/somepage\/&quot;
      }
</code>
</pre>
</li>
<li>
<p>If the message is &quot;success=&gt;true&quot;::</p>
<ol>
<li>The endpoint should publish a story using the &quot;save&quot; action against the same object (&quot;recipe&quot;) on behalf of User 2.</li>
<li>Then return a JSON encoded &quot;success&quot; message.</li>
<li>User 2 will simply see the action link text of &quot;Save This Recipe&quot; change to &quot;Saved&quot; (the past tense definition for the action &quot;save&quot;) in the story they clicked.</li>
<li>Note: if the user were to refresh that story or see it again, they would no longer see an action link for &quot;Save This Recipe&quot; because a story has been published for them already (&quot;saved a recipe&quot;).</li>
</ol>
</li>
<li>Else if the message is &quot;redirect=&gt;http://www.example.com/somepage/&quot;:: <ol>
<li>The endpoint may decide to redirect the user from Facebook possibly to install the app first or provide some additional context about the action. To do this the endpoint should respond with a JSON encoded &quot;redirect&quot; message along with the redirect_url.</li>
<li>User 2 will then see a dialog box telling them that they can visit your app to continue the process. Since the user is supposed to stay on Facebook, this flow is considered an error case.</li>
</ol>
</li>
</ul>
</li>
</ol>
<p style="text-align:center">
<img src="https://developers.facebook.com/attachment/action_links_redirect_popup.png/" />
</p>
<h3>Suppressing Action Links</h3>
<p>If you have configured action links in the <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">App Dashboard</a> you can suppress the action link appearing for a particular story. To do this when you publish the action pass in <code>no_action_link=true</code>.</p>
<h3>Integration Points</h3>
<p>These are the steps that you need to do to properly handle action links:</p>
<ul>
<li>Configure the action link to action association using the <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">App Dashboard</a>.</li>
<li>Implement the server endpoint that will handle the action link calls.</li>
<li>Optionally configure <a href="/docs/opengraph/authentication/#referrals" name="https://developers.facebook.com/docs/opengraph/authentication/#referrals">Authenticated Referrals</a> if you want to pre-authorize users who click on an action link and have not installed the app.</li>
</ul>
<p>We will walk you through the configuration steps and also show some sample code for an action link handler.</p>
<hr />
<h2 id="config">Configuration</h2>
<p>Action Links configuration is done through the <a href="https://developers.facebook.com/apps" name="https://developers.facebook.com/apps" target="_blank">App Dashboard</a>, by associating one action with another action. You must configure each action so they are associated with the same object.</p>
<ol>
<li>If you have not already done so, create a new action to represent your action link. In our previous example we would have added a &quot;save&quot; action.</li>
<li>Edit the main action, e.g. the &quot;cook&quot; action in our example to make the association. Click on the Advanced section. Fill in the <strong>Linked Action</strong> field using the type-ahead and selecting your action link, e.g. &quot;save&quot; in our example.</li>
<li>Add the endpoint information for your action link. This is the endpoint that will be called when the action link is clicked in a story. This endpoint must match the domain of the app and must be a valid https:// endpoint. Fill in the <strong>Action Link URL</strong> field in the Advanced section for the main action, e.g. the &quot;cook&quot; action in our example.</li>
</ol>
<p style="text-align:center">
<img src="https://developers.facebook.com/attachment/og_actionlink_devapp_4.png/" width="90%" />
</p>
<p>You may want to change the &quot;Imperative Tense&quot; displayed for an action link. By default the imperative tense is set to be the same as the &quot;Present Tense&quot; setting. So in our example, the action link is &quot;save&quot; and the imperative tense we want is &quot;save&quot;. So we do not need to change the default setting.</p>
<p style="text-align:center">
<img src="https://developers.facebook.com/attachment/og_actionlink_devapp_6.png/" width="90%" />
</p>
<p>
<strong>Note:</strong> If you already have Open Graph action types that have been approved then your &quot;Imperative Tense&quot; settings will match your &quot;Present Tense&quot; settings and at this time you will not be able to change the setting.</p>
<hr />
<h2 id="test">Testing Your Implementation</h2>
<ol>
<li>After configuring your actions and setting the correct imperative tense and setting the action and endpoints, you&apos;re ready to start testing</li>
<li>As a developer, post a story using the configured action.</li>
<li>As the same developer, goto your profile and then to your Activity Log.</li>
<li>You will see the story you just posted; click on the timestamp on the left to show what the story looks like in News Feed</li>
<li>You should see that the story has an action link in it at the bottom of the post next to Like, Comment and Unfollow this Post.</li>
<li>Click the Action Link, which will then call the endpoint you configured server-to-server. <ol>
<li>On your server, simply have the endpoint returned a json encoded &quot;success&quot; message</li>
<li>In the story, you will see the Action Link text change to the past tense.</li>
<li>As a developer, if there is an issue with the endpoint or with the returned value, you will get an error message in the story UI with the error details.</li>
</ol>
</li>
</ol>
<h3>Re-Testing</h3>
<ul>
<li>Once you publish a story using the Imperative Tense action for a given object for a user, that user will no longer see any Action Link text in future stories. While you&apos;re testing, to re-enable that Action Link test, you can simply find the action_id for the Action Link story and perform an http DELETE to endping https://graph.facebook.com/&lt;action_id&gt; which will return &quot;true&quot;. If you then refresh any story that has an Action Link configured, you will once again see the Action Link at the bottom of the story.</li>
<li>In the example above, you would DELETE the &quot;saved a recipe&quot; story, which is the Action Link story to the main story &quot;cooked a recipe&quot;.</li>
</ul>
<hr />
<h2 id="faq">Frequently Asked Questions</h2>
<p>Q: What happens if I don&apos;t publish a story when a user clicks on the action link?<br /> A: Each time the user comes back to that story, they will see the option of clicking the Action Link. If you don&apos;t publish a story to stop this, that will become annoying to the user and lead to a bad experience for them.</p>
<p>Q: Do Action Links display in Mobile News Feed?<br /> A: We have not yet enabled this, but yes, we will be shortly.</p>
<p>Q: Can I create aggregations from my Action Link stories?<br /> A: Yes, Action Link stories are exactly the same type of stories as any other story and can have complex properties and interesting aggregations.</p>
<p>Q: Do I need to have an https endpoint for my action link?<br /> A: Only if you&apos;re not in sandbox mode. If you&apos;re developing and have sandbox mode turned on, then our system will simply hit the http:// version of the endpoint you&apos;ve entered.</p>
<hr />
<h2 id="code">Sample Code</h2>
<p>Here is sample code for an action link endpoint. This corresponds to our sample app where the endpoint processes the incoming data, extracts the &quot;recipe&quot; object and publishes the &quot;save&quot; action. Finally the endpoint returns a &quot;success=&gt;true&quot; JSON response.</p>
<pre>
<code>&lt;?php

  $app_id = &apos;APP_ID&apos;; // Your app Id
  $app_secret = &quot;APP_SECRET&quot;; // Your app secret

  // Function to parse an incoming signed request and get the
  // data
  function parse_signed_request($signed_request, $secret) {
    list($encoded_sig, $payload) = explode(&apos;.&apos;, $signed_request, 2);

    $sig = base64_url_decode($encoded_sig);
    $data = json_decode(base64_url_decode($payload), true);

    if (strtoupper($data[&apos;algorithm&apos;]) !== &apos;HMAC-SHA256&apos;) {
      error_log(&apos;Unknown algorithm. Expected HMAC-SHA256&apos;);
      return null;
    }

    // Check the signature
    $expected_sig = hash_hmac(&apos;sha256&apos;, $payload, $secret, $raw = true);
    if ($sig !== $expected_sig) {
      error_log(&apos;Bad Signed JSON signature!&apos;);
      return null;
    }
    return $data;
  }

  // Helper function for parsing signed request
  function base64_url_decode($input) {
    return base64_decode(strtr($input, &apos;-_&apos;, &apos;+/&apos;));
  }

  // Variable to hold success result
  $success_result = &apos;false&apos;;

  // Parse the signed request
  $parsed_data = parse_signed_request($_REQUEST[&apos;signed_request&apos;],$app_secret);
  if ($parsed_data != null) {
    // Get the access token
    $access_token = $parsed_data[&apos;oauth_token&apos;];
    // Get the object URL
    $recipe = $parsed_data[&apos;objects&apos;][0][&apos;url&apos;];

    // The Graph API endpoint for publishing a save action
    $graph_url_publish = 
      &quot;https://graph.facebook.com/me/nyccookbook:save?access_token=&quot; . $access_token;
    $postdata = http_build_query(
      array(
        &apos;recipe&apos; =&gt; $recipe
      )
    );
    $opts = array(&apos;http&apos; =&gt;
      array(
        &apos;method&apos;  =&gt; &apos;POST&apos;,
        &apos;header&apos;  =&gt; &apos;Content-type: application/x-www-form-urlencoded&apos;,
        &apos;content&apos; =&gt; $postdata
      )
    );
    $context  = stream_context_create($opts);
    // Publish the save action
    $result = json_decode(file_get_contents($graph_url_publish, false, $context));
    if (($result != null) &amp;&amp; isset($result-&gt;id)) {
      // Set the result flag to true
      $success_result = &apos;true&apos;;
    }
  }

  // Print the output
  $success = array(
    &apos;success&apos; =&gt; $success_result
  );
  $output = json_encode($success);
  echo $output;
?&gt;
</code>
</pre>
<div class="mtl pvm uiBoxWhite topborder">
<div class="mbm lfloat">
<fb:like href="http://developers.facebook.com/docs/opengraph/actionlinks/" send="true" show_faces="false">
</fb:like>
</div>
<div class="clear">
<abbr class="timestamp" data-utime="1337708207" title="2012年5月22日 10:36">2012年5月22日 10:36</abbr>
</div>
</div></div>

</body>
</html>
