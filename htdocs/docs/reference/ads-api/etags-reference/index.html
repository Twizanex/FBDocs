<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>https://developers.facebook.com/docs/reference/ads-api/etags-reference/</title>
<link rel="stylesheet" href="/css/common.css" media="screen" />
<script src="/js/common.js"></script>
</head>
<body>
<a id="oklahomer-orig-url" href="https://developers.facebook.com/docs/reference/ads-api/etags-reference/">https://developers.facebook.com/docs/reference/ads-api/etags-reference/</a>

<div id="oklahomer-menu-wrapper">
<div class="toplevelnav">
<ul>
<li>
<a href="/docs/" name="https://developers.facebook.com/docs/" target="">
<div class="navSectionTitle">Getting Started</div>
</a>
</li>
<li>
<a href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts" target="">
<div class="navSectionTitle">Core Concepts</div>
</a>
</li>
<li class="active withsubsections">
<a class="selected" href="/docs/advancedtopics/" name="https://developers.facebook.com/docs/advancedtopics" target="">
<div class="navSectionTitle">Advanced Topics</div>
</a>
<ul class="subsections">
<li>
<a href="/docs/reference/dialogs/" name="https://developers.facebook.com/docs/reference/dialogs/" target="">Dialogs</a>
</li>
<li>
<a href="/docs/reference/fql/" name="https://developers.facebook.com/docs/reference/fql/" target="">FQL</a>
</li>
<li>
<a href="/docs/internationalization/" name="https://developers.facebook.com/docs/internationalization" target="">Internationalization</a>
</li>
<li>
<a class="selected" href="/docs/reference/ads-api/" name="https://developers.facebook.com/docs/reference/ads-api" target="">Ads API</a>
</li>
<li>
<a href="/docs/credits/" name="https://developers.facebook.com/docs/credits" target="">Credits</a>
</li>
<li>
<a href="/docs/chat/" name="https://developers.facebook.com/docs/chat" target="">Chat API</a>
</li>
<li>
<a href="/docs/reference/rest/" name="https://developers.facebook.com/docs/reference/rest/" target="">Legacy REST API</a>
</li>
<li>
<a href="/docs/reference/fbml/" name="https://developers.facebook.com/docs/reference/fbml/" target="">Legacy FBML</a>
</li>
<li>
<a href="/docs/fbjs/" name="https://developers.facebook.com/docs/fbjs/" target="">Legacy FBJS</a>
</li>
<li>
<a href="/docs/reference/oldjavascript/" name="https://developers.facebook.com/docs/reference/oldjavascript/" target="">Legacy Javascript SDK</a>
</li>
</ul>
</li>
<li>
<a href="/docs/sdks/" name="https://developers.facebook.com/docs/sdks" target="">
<div class="navSectionTitle">SDK Reference</div>
</a>
</li>
<li>
<a href="https://developers.facebook.com/tools" name="https://developers.facebook.com/tools" target="_blank">
<div class="navSectionTitle">Tools</div>
</a>
</li>
</ul>
</div>
<ul id="navsubsectionpages">
<li>
</li>
<li>
<h5>Best Practices</h5>
<ul>
<li>
<a href="/docs/reference/ads-api/batch-requests/" name="http://developers.facebook.com/docs/reference/ads-api/batch-requests/" target="">Batch Requests</a>
</li>
<li>
<a href="/docs/reference/ads-api/etags-reference/" name="http://developers.facebook.com/docs/reference/ads-api/etags-reference/" target="">Using ETags</a>
</li>
</ul>
</li>
<li>
<h5>Reference</h5>
<ul>
<li>
<a href="/docs/reference/ads-api/currencies/" name="http://developers.facebook.com/docs/reference/ads-api/currencies/" target="">Currencies</a>
</li>
<li>
<a href="/docs/reference/ads-api/intro-action-specs/" name="http://developers.facebook.com/docs/reference/ads-api/intro-action-specs/" target="">Introduction to Action Spec</a>
</li>
<li>
<a href="/docs/reference/ads-api/intro-sponsored-stories/" name="http://developers.facebook.com/docs/reference/ads-api/intro-sponsored-stories/" target="">Introduction to Sponsored Stories</a>
</li>
<li>
<a href="/docs/reference/ads-api/optimizedcpm/" name="http://developers.facebook.com/docs/reference/ads-api/optimizedcpm/" target="">Optimized CPM</a>
</li>
</ul>
</li>
<li>
<h5>Specs</h5>
<ul>
<li>
<a href="/docs/reference/ads-api/conversion-specs/" name="http://developers.facebook.com/docs/reference/ads-api/conversion-specs/" target="">Conversion Specs</a>
</li>
<li>
<a href="/docs/reference/ads-api/creative-specs/" name="http://developers.facebook.com/docs/reference/ads-api/creative-specs/" target="">Creative Specs</a>
</li>
<li>
<a href="/docs/reference/ads-api/start-action-specs/" name="http://developers.facebook.com/docs/reference/ads-api/start-action-specs/" target="">Defining Action Specs </a>
</li>
<li>
<a href="/docs/reference/ads-api/targeting-specs/" name="http://developers.facebook.com/docs/reference/ads-api/targeting-specs/" target="">Targeting Specs</a>
</li>
</ul>
</li>
<li>
<h5>Advanced Targeting</h5>
<ul>
<li>
<a href="/docs/reference/ads-api/action-specs-targeting/" name="http://developers.facebook.com/docs/reference/ads-api/action-specs-targeting/" target="">Action Spec Targeting</a>
</li>
<li>
<a href="/docs/reference/ads-api/topic-targeting/" name="http://developers.facebook.com/docs/reference/ads-api/topic-targeting/" target="">Topic Targeting</a>
</li>
<li>
<a href="/docs/reference/ads-api/zipcode-targeting/" name="http://developers.facebook.com/docs/reference/ads-api/zipcode-targeting/" target="">ZIP Code Targeting</a>
</li>
</ul>
</li>
<li>
<h5>Queries</h5>
<ul>
<li>
<a href="/docs/reference/ads-api/actionestimate/" name="http://developers.facebook.com/docs/reference/ads-api/actionestimate/" target="">Action Estimate</a>
</li>
<li>
<a href="/docs/reference/ads-api/generatepreview/" name="http://developers.facebook.com/docs/reference/ads-api/generatepreview/" target="">Action Spec Ad Previews</a>
</li>
<li>
<a href="/docs/reference/ads-api/adstatistics/" name="http://developers.facebook.com/docs/reference/ads-api/adstatistics/" target="">Ad Statistics</a>
</li>
<li>
<a href="/docs/reference/ads-api/get-autocomplete-data/" name="http://developers.facebook.com/docs/reference/ads-api/get-autocomplete-data/" target="">Autocomplete Data</a>
</li>
<li>
<a href="/docs/reference/ads-api/broadcategorytargeting/" name="http://developers.facebook.com/docs/reference/ads-api/broadcategorytargeting/" target="">Broad Target Categories</a>
</li>
<li>
<a href="/docs/reference/ads-api/connectionobjects/" name="http://developers.facebook.com/docs/reference/ads-api/connectionobjects/" target="">Connection Objects</a>
</li>
<li>
<a href="/docs/reference/ads-api/conversionstatistics/" name="http://developers.facebook.com/docs/reference/ads-api/conversionstatistics/" target="">Conversion Stats</a>
</li>
<li>
<a href="/docs/reference/ads-api/keywordstats/" name="http://developers.facebook.com/docs/reference/ads-api/keywordstats/" target="">Keyword Stats</a>
</li>
<li>
<a href="/docs/reference/ads-api/reachestimate/" name="http://developers.facebook.com/docs/reference/ads-api/reachestimate/" target="">Reach estimate</a>
</li>
<li>
<a href="/docs/reference/ads-api/targeting-description/" name="http://developers.facebook.com/docs/reference/ads-api/targeting-description/" target="">Targeting Description</a>
</li>
</ul>
</li>
<li>
<h5>Objects</h5>
<ul>
<li>
<a href="/docs/reference/ads-api/adaccount/" name="http://developers.facebook.com/docs/reference/ads-api/adaccount/" target="">Ad account</a>
</li>
<li>
<a href="/docs/reference/ads-api/adaccountgroup/" name="http://developers.facebook.com/docs/reference/ads-api/adaccountgroup/" target="">Ad account group</a>
</li>
<li>
<a href="/docs/reference/ads-api/adcampaign/" name="http://developers.facebook.com/docs/reference/ads-api/adcampaign/" target="">Ad campaign</a>
</li>
<li>
<a href="/docs/reference/ads-api/adcreative/" name="http://developers.facebook.com/docs/reference/ads-api/adcreative/" target="">Ad creative</a>
</li>
<li>
<a href="/docs/reference/ads-api/adgroup/" name="http://developers.facebook.com/docs/reference/ads-api/adgroup/" target="">Ad group</a>
</li>
<li>
<a href="/docs/reference/ads-api/adimage/" name="http://developers.facebook.com/docs/reference/ads-api/adimage/" target="">Ad image</a>
</li>
<li>
<a href="/docs/reference/ads-api/aduser/" name="http://developers.facebook.com/docs/reference/ads-api/aduser/" target="">Ad user</a>
</li>
</ul>
</li>
</ul></div>

<div id="oklahomer-content-wrapper">
<div class="header">
<div class="content">
<h1>Using ETags</h1>
<div class="breadcrumbs">
<a href="/docs/advancedtopics/" name="https://developers.facebook.com/docs/advancedtopics/">Advanced Topics</a> › <a href="/docs/reference/ads-api/" name="https://developers.facebook.com/docs/reference/ads-api/">Ads API</a> › <a href="/docs/reference/ads-api/etags-reference/" name="https://developers.facebook.com/docs/reference/ads-api/etags-reference/">Using ETags</a>
</div>
</div>
</div>
<p>The Facebook Marketing API now supports <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.19" name="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.19">Etags</a> on the Graph API. This means that the API can tell you if the data you are querying has changed since you last checked.</p>
<h2>Using ETags:</h2>
<ol>
<li>When you make a Graph API call, the response header includes an ETag with a value which is the hash of the data returned in the API call. Save this ETag value for use in the next step.</li>
<li>Next time you make the same API call, include the <strong>If-None-Match</strong> request header with the ETag value saved from the first step.</li>
<li>If the data has not changed, the response status code will be 304 – Not Modified and no data is returned.</li>
<li>If the data has changed since the last query, the data is returned as usual with a new ETag. Save the new ETag value and use it for subsequent calls.</li>
</ol>
<p>
<strong>Note</strong>: While ETags help reduce the data traffic, the If-None-Match GET will still count against the throttling limits for your app.</p>
<p>The ETag is calculated using the entire response from the API call including its formatting. Developers should be aware that the formatting of API response output may be impacted by the user agent string. Therefore, calls originating from the same client should keep the user agent consistent between calls.</p>
<h2>Simple Example:</h2>
<p>A simple example to check is the user&apos;s adaccounts have changed</p>
<p>
<strong>Step 1</strong>; Determine the ETag for the current data</p>
<pre>
<code>curl -i &quot;https://graph.beta.facebook.com/me/adaccounts?access_token=___&quot;
</code>
</pre>
<p>The response will be as follows:</p>
<pre>
<code>HTTP/1.1 200 OK
Access-Control-Allow-Origin: *
Cache-Control: private, no-cache, no-store, must-revalidate
Content-Type: text/javascript; charset=UTF-8
ETag: &quot;7776cdb01f44354af8bfa4db0c56eebcb1378975&quot;
Expires: Sat, 01 Jan 2000 00:00:00 GMT
Pragma: no-cache
X-FB-Rev: 495685
X-FB-Server: 10.30.149.204
X-FB-Debug: CWbHcogdwUE8saMv6ML+8FacXFrE8ufhjjwxU2dQWaA=
X-Cnection: close
Date: Mon, 16 Jan 2012 12:07:44 GMT
Content-Length: 3273

{&quot;data&quot;:[{&quot;id&quot;:&quot;act.......
</code>
</pre>
<p>In this example the ETag is &quot;7776cdb01f44354af8bfa4db0c56eebcb1378975&quot;, note that the ETag includes the quotes (&quot;).</p>
<p>
<strong>Step 2</strong>; Determine if there have been any changes to the data</p>
<pre>
<code>curl -i -H &quot;If-None-Match: \&quot;7776cdb01f44354af8bfa4db0c56eebcb1378975\&quot;&quot; &quot;https://graph.beta.facebook.com/me/adaccounts?access_token=___&quot;
</code>
</pre>
<p>If nothing has changed the response will be as follows:</p>
<pre>
<code>HTTP/1.1 304 Not Modified
Access-Control-Allow-Origin: *
Cache-Control: private, no-cache, no-store, must-revalidate
Content-Type: text/javascript; charset=UTF-8
Expires: Sat, 01 Jan 2000 00:00:00 GMT
Pragma: no-cache
X-FB-Rev: 495685
X-FB-Server: 10.30.177.190
X-FB-Debug: ImBhat3k07Nez5FvuS2lPWU0U2xxmxD4B3k9ua4Sk7Q=
X-Cnection: close
Date: Mon, 16 Jan 2012 12:09:17 GMT
Content-Length: 0
</code>
</pre>
<p>Note the <strong>304 Not Modified</strong> response. If the data had changed a normal API response would be returned.</p>
<h2>Batch Example:</h2>
<p>A batch example to check is the user&apos;s adgroups have changed</p>
<p>
<strong>Step 1</strong>; Determine the ETag for the current data</p>
<pre>
<code>curl -i &quot;curl -F &apos;access_token=___&apos; -F &apos;batch=[ 
  {&quot;method&quot;:&quot;GET&quot;, &quot;relative_url&quot;: &quot;?ids=6003356308839,6004164369439&quot; }, 
  {&quot;method&quot;:&quot;GET&quot;, &quot;relative_url&quot;: &quot;act_12345678/adgroups?campaign_ids=[6003356307839, 6004164259439]&quot;}]&apos;
 https://graph.facebook.com&quot;
</code>
</pre>
<p>The response will contain ETag values as follows:</p>
<pre>
<code>...{&quot;name&quot;:&quot;ETag&quot;,&quot;value&quot;:&quot;\&quot;21d371640127490b2ed0387e8af3f0f8c9eff012\&quot;&quot;}...      
...{&quot;name&quot;:&quot;ETag&quot;,&quot;value&quot;:&quot;\&quot;410e53bb257f116e8716e4ebcc76df1c567b87f4\&quot;&quot;}...
</code>
</pre>
<p>In this example the ETags are &quot;21d371640127490b2ed0387e8af3f0f8c9eff012&quot; and &quot;410e53bb257f116e8716e4ebcc76df1c567b87f4&quot; note that the ETag includes the quotes (&quot;).</p>
<p>
<strong>Step 2</strong>; Determine if there have been any changes to the data</p>
<pre>
<code>curl -F &apos;access_token=___&apos; -F &apos;batch=[
  {&quot;method&quot;:&quot;GET&quot;, &quot;headers&quot;:[&quot;If-None-Match: \&quot;21d371640127490b2ed0387e8af3f0f8c9eff012\&quot;&quot;], &quot;relative_url&quot;: &quot;?ids=6003356308839,6004164369439&quot; },
  {&quot;method&quot;:&quot;GET&quot;,  &quot;headers&quot;:[&quot;If-None-Match: \&quot;410e53bb257f116e8716e4ebcc76df1c567b87f4\&quot;&quot;], &quot;relative_url&quot;: &quot;act_12345678/adgroups?campaign_ids=[6003356307839, 6004164259439]&quot;}]&apos; 
https://graph.facebook.com
</code>
</pre>
<p>If nothing has changed the response will be as follows:</p>
<pre>
<code>[{
    &quot;code&quot;: 304,
    .
    .
    .
    &quot;body&quot;: null
},
{
    &quot;code&quot;: 304,
    .
    .
    .
    &quot;body&quot;: null
}]
</code>
</pre>
<p>Note the <strong>304 Not Modified</strong> response. If the data had changed a normal API response would be returned.</p>
<div class="mtl pvm uiBoxWhite topborder">
<div class="mbm lfloat">
<fb:like href="http://developers.facebook.com/docs/reference/ads-api/etags-reference/" send="true" show_faces="false">
</fb:like>
</div>
<div class="clear">
<abbr class="timestamp" data-utime="1331572062" title="2012年3月12日 10:07">2012年3月12日 10:07</abbr>
</div>
</div></div>

</body>
</html>
