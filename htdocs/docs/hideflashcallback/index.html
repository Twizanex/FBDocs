<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>https://developers.facebook.com/docs/hideflashcallback/</title>
<link rel="stylesheet" href="/css/common.css" media="screen" />
<script src="/js/common.js"></script>
</head>
<body>
<a id="oklahomer-orig-url" href="https://developers.facebook.com/docs/hideflashcallback/">https://developers.facebook.com/docs/hideflashcallback/</a>

<div id="oklahomer-menu-wrapper">
<div class="toplevelnav">
<ul>
<li class="active withsubsections">
<a class="selected" href="/docs/" name="https://developers.facebook.com/docs/" target="">
<div class="navSectionTitle">Getting Started</div>
</a>
<ul class="subsections">
<li>
<a href="/docs/guides/web/" name="https://developers.facebook.com/docs/guides/web" target="">Websites</a>
</li>
<li>
<a href="/docs/guides/canvas/" name="https://developers.facebook.com/docs/guides/canvas" target="">Apps on Facebook</a>
</li>
<li>
<a href="/docs/guides/mobile/" name="https://developers.facebook.com/docs/guides/mobile" target="">Mobile</a>
</li>
<li>
<a href="/docs/appcenter/" name="https://developers.facebook.com/docs/appcenter/" target="">App Center</a>
</li>
<li>
<a href="/docs/bestpractices/" name="https://developers.facebook.com/docs/bestpractices/" target="">Best Practices</a>
</li>
<li>
<a href="/docs/samples/" name="https://developers.facebook.com/docs/samples" target="">Samples &amp; How-Tos</a>
</li>
<li>
<a href="https://developers.facebook.com/videos" name="https://developers.facebook.com/videos" target="_blank">Videos</a>
</li>
</ul>
</li>
<li>
<a href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts" target="">
<div class="navSectionTitle">Core Concepts</div>
</a>
</li>
<li>
<a href="/docs/advancedtopics/" name="https://developers.facebook.com/docs/advancedtopics" target="">
<div class="navSectionTitle">Advanced Topics</div>
</a>
</li>
<li>
<a href="/docs/sdks/" name="https://developers.facebook.com/docs/sdks" target="">
<div class="navSectionTitle">SDK Reference</div>
</a>
</li>
<li>
<a href="https://developers.facebook.com/tools" name="https://developers.facebook.com/tools" target="_blank">
<div class="navSectionTitle">Tools</div>
</a>
</li>
</ul>
</div>
<ul id="navsubsectionpages">
<li>
</li>
<li>
<h5>Getting Started</h5>
<ul>
<li>
<a href="/docs/appsonfacebook/tutorial/" name="http://developers.facebook.com/docs/appsonfacebook/tutorial/" target="">Canvas Tutorial</a>
</li>
<li>
<a href="/docs/guides/games/getting-started/" name="http://developers.facebook.com/docs/guides/games/getting-started/" target="">Social Games Tutorial</a>
</li>
<li>
<a href="/docs/guides/games/growth/" name="http://developers.facebook.com/docs/guides/games/growth/" target="">Social Channels for Games</a>
</li>
<li>
<a href="/docs/requests/" name="http://developers.facebook.com/docs/requests/" target="">Requests Overview</a>
</li>
<li>
<a href="/docs/appsonfacebook/pagetabs/" name="http://developers.facebook.com/docs/appsonfacebook/pagetabs/" target="">Page Tab Tutorial</a>
</li>
</ul>
</li>
<li>
<h5>Best Practices</h5>
<ul>
<li>
<a href="/docs/guides/games/auth/" name="http://developers.facebook.com/docs/guides/games/auth/" target="">Authentication Pro-tips</a>
</li>
<li>
<a href="/docs/guides/games/requests/" name="http://developers.facebook.com/docs/guides/games/requests/" target="">Requests Pro-tips</a>
</li>
<li>
<a href="/docs/guides/games/feed/" name="http://developers.facebook.com/docs/guides/games/feed/" target="">Feed Pro-tips</a>
</li>
<li>
<a href="/docs/guides/games/canvas/" name="http://developers.facebook.com/docs/guides/games/canvas/" target="">Integrating with Canvas</a>
</li>
<li>
<a href="/docs/guides/games/monetization/" name="http://developers.facebook.com/docs/guides/games/monetization/" target="">Games Monetization</a>
</li>
</ul>
</li>
<li>
<h5>Showcase</h5>
<ul>
<li>
<a href="/docs/arcadegames/" name="http://developers.facebook.com/docs/arcadegames/" target="">Arcade Games</a>
</li>
<li>
<a href="/docs/bingobash/" name="http://developers.facebook.com/docs/bingobash/" target="">Bingo Bash</a>
</li>
<li>
<a href="/docs/diamonddash/" name="http://developers.facebook.com/docs/diamonddash/" target="">Diamond Dash</a>
</li>
<li>
<a href="http://developers.facebook.com/showcase/games/" name="http://developers.facebook.com/showcase/games/" target="_blank">Games Gallery</a>
</li>
</ul>
</li>
<li class="active">
<h5>How Tos</h5>
<ul>
<li>
<a href="/docs/fluidcanvas/" name="http://developers.facebook.com/docs/fluidcanvas/" target="">Fluid Canvas</a>
</li>
<li>
<a href="/docs/feed-gaming/" name="http://developers.facebook.com/docs/feed-gaming/" target="">Feed Gaming</a>
</li>
<li>
<a class="selected" href="/docs/hideflashcallback/" name="http://developers.facebook.com/docs/hideflashcallback/" target="">Flash wmode</a>
</li>
<li>
<a href="/docs/guides/games/custom-muti-friend-selector/" name="http://developers.facebook.com/docs/guides/games/custom-muti-friend-selector/" target="">Multi-Friend Selector</a>
</li>
</ul>
</li>
<li>
<h5>Reference</h5>
<ul>
<li>
<a href="/docs/achievements/" name="http://developers.facebook.com/docs/achievements/" target="">Achievements</a>
</li>
<li>
<a href="/docs/score/" name="http://developers.facebook.com/docs/score/" target="">Scores</a>
</li>
<li>
<a href="/docs/reqests_dialog/" name="http://developers.facebook.com/docs/reqests_dialog/" target="">Requests Dialog</a>
</li>
<li>
<a href="/docs/fb_source/" name="http://developers.facebook.com/docs/fb_source/" target="">fb_source Parameter</a>
</li>
</ul>
</li>
</ul></div>

<div id="oklahomer-content-wrapper">
<div class="header">
<div class="content">
<h1>Flash wmode</h1>
<div class="breadcrumbs">
<a href="/docs/" name="https://developers.facebook.com/docs/">Getting Started</a> › <a href="/docs/guides/canvas/" name="https://developers.facebook.com/docs/guides/canvas/">Apps on Facebook</a> › <a href="/docs/hideflashcallback/" name="https://developers.facebook.com/docs/hideflashcallback/">Flash wmode</a>
</div>
</div>
</div>
<p>This How-To will walk you through the process of creating a temporary dynamic screenshot of your Flash App and replacing the Flash Object with this image within 200ms. This allows Dialogs to display correctly and creates a more pleasing user experience.</p>
<p>
<img src="https://developers.facebook.com/attachment/flash_hide_callback_example.jpg" width="90%" />
</p>
<p>The How-To is divided into the following sections:</p>
<ol>
<li>
<a href="/docs/#dyn_screenshot" name="https://developers.facebook.com/docs/#dyn_screenshot">Creating a Dynamic Screenshot in Flash</a>
</li>
<li>
<a href="/docs/#as_js_comm" name="https://developers.facebook.com/docs/#as_js_comm">Enabling ActionScript to JavaScript Communication</a>
</li>
<li>
<a href="/docs/#data_uri" name="https://developers.facebook.com/docs/#data_uri">Using a Data URI</a>
</li>
<li>
<a href="/docs/#flash_hide_callback" name="https://developers.facebook.com/docs/#flash_hide_callback">Setting up the hideFlashCallback Functionality</a>
</li>
<li>
<a href="/docs/#source_code" name="https://developers.facebook.com/docs/#source_code">Source Code for the Example App</a>
</li>
</ol>
<p>Developers are expected to be familiar with JavaScript and ActionScript 3.0 in order to continue. <a name="dyn_screenshot">
</a>  </p>
<h2>Creating a Dynamic Screenshot in Flash</h2>
<p>The first step will be to implement a method within your Flash App that creates a dynamic screenshot of the Stage object, compresses this into a JPEG format and then Base64 encodes this string. Fortunately there are public libraries available that will take care of most of these steps. For this example we will use: <a href="http://www.blooddy.by/en/crypto/" name="http://www.blooddy.by/en/crypto/">http://www.blooddy.by/en/crypto/</a> or feel free to use any lib that you prefer.</p>
<p>Next we will create the ActionScript <code>exportScreenshot</code> method that will return our screenshot data string, ready for use.</p>
<p>
<strong>ActionScript</strong>
</p>
<pre>
import by.blooddy.crypto.Base64;
import by.blooddy.crypto.image.JPEGEncoder;

...

private function exportScreenshot():String {
  var scale:Number = 0.25;
  var result:String = null;
  var blurFilter:BlurFilter = new BlurFilter(3, 3, BitmapFilterQuality.HIGH);

  var bData:BitmapData = new BitmapData(stage.stageWidth * scale,
    stage.stageHeight * scale,false,0x0);
  var matrix:Matrix = new Matrix();
  matrix.scale(scale, scale);

  bData.draw(stage, matrix);
  bData.applyFilter(bData, bData.rect, new Point(0, 0), blurFilter);

  var jpgBytes:ByteArray = JPEGEncoder.encode(bData,80);
  if (jpgBytes) {
    var screenshotBase64:String = Base64.encode(jpgBytes);
    if (screenshotBase64) {
      result = screenshotBase64;
    }
  }

  return result;
}
</pre>
<p>Walking through the code line by line you will notice that we are scaling the image to 25% of the full Stage dimensions. This is to reduce the size of our screenshot image and increase overall performance. Next we apply a BlurFilter to smooth out the jagged edges that result. Finally we encode our Bitmap as a JPEG, base64 encode it and then return the string. <a name="as_js_comm">
</a>  </p>
<h2>Enabling ActionScript to JavaScript Communication</h2>
<p>Now that we have a method in our Flash App that can create a dynamic screenshot image we will need to support JavaScript communication from within the Flash Object. This will allow us to create a screenshot dynamically through a JavaScript call.</p>
<p>To do this we will need to import the <code>ExternalInterface</code> class in our Flash App and register a callback method.</p>
<p>
<strong>ActionScript</strong>
</p>
<pre>
import flash.external.ExternalInterface

...

ExternalInterface.addCallback(&apos;exportScreenshot&apos;, exportScreenshot);
</pre>
<p>The code registers a callback method called <code>exportScreenshot</code> in JavaScript allowing us to call our ActionScript method of the same name from JavaScript directly. <a name="data_uri">
</a>  </p>
<h2>Using a Data URI</h2>
<p>Next we will create a image HTML element that will contain our dynamic screenshot and replace the Flash Object temporarily. To implement this we will use a <a href="http://en.wikipedia.org/wiki/Data_URI_scheme" name="http://en.wikipedia.org/wiki/Data_URI_scheme">Data URI</a> allowing us to define the image data inline without having to make any requests back to a web server, increasing our performance.</p>
<p>
<strong>Note</strong>: This is only available in modern browsers, Internet Explorer 8 and above. For IE7 and below you will have to fallback to a static image and cannot use the method described in this How-To.</p>
<p>In the HTML below we define a <code>div</code> HTML element that will contain our Flash content and directly underneath, a <code>div</code> HTML element that contains our <code>img</code> element that will hold our screenshot image. Finally we set both of these elements to have absolute position within a relative positioned parent. This allows us to place the <code>img</code> element beneath our Flash Object.</p>
<p>
<strong>HTML</strong>
</p>
<pre>
&lt;div id=&quot;allContent&quot; style=&quot;position:relative;&quot;&gt;
  &lt;div id=&quot;flashContent&quot; style=&quot;position:absolute&quot;&gt;
    &lt;div id=&quot;flashHolder&quot;&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;div id=&quot;imageContent&quot; style=&quot;position:absolute; top: -10000px;&quot;&gt;
  &lt;img id=&quot;screenshotObject&quot;
    src=&quot;blank.gif&quot;
    style=&quot;margin: 0 auto; display:block;&quot; /&gt;
&lt;/div&gt;
</pre>
<p>After we call the <code>exportScreenshot</code> method from JavaScript to get our dynamic screenshot, we set the dimensions of our <code>img</code> element to match the Flash Object, move the Flash Object out of the display area and put the screenshot image in it&apos;s place.</p>
<p>
<strong>JavaScript</strong>
</p>
<pre>
// Call the Flash Actionscript method to create the dynamic screenshot
var screenshotData =
  document.getElementById(&apos;flashObject&apos;).exportScreenshot();

// Set the screenshot image data as a base64 encoded data URI
// in the img src attribute
document.getElementById(&apos;screenshotObject&apos;).src = &apos;data:image/jpeg;base64,&apos;
  + screenshotData;

// Set the screenshot img dimensions to match the Flash object tag.
document.getElementById(&apos;screenshotObject&apos;).width = flashObject.width;
document.getElementById(&apos;screenshotObject&apos;).height = flashObject.height;
  
// Move the Flash object off the screen and put the screenshot in it&apos;s place
document.getElementById(&apos;flashContent&apos;).style.top = &apos;-10000px&apos;;
document.getElementById(&apos;imageContent&apos;).style.top = &apos;&apos;;
</pre>
<p>
<a name="flash_hide_callback">
</a>  </p>
<h2>Setting up the hideFlashCallback Functionality</h2>
<p>The last step is putting all of this code together and executing it based on the <a href="/docs/reference/javascript/#flash_hide_callback" name="https://developers.facebook.com/docs/reference/javascript/#flash_hide_callback">hideFlashCallback</a> callback. To do this, we wrap our JavaScript code (above) into a function called <code>displayFlashScreenshot</code> and create a new method <code>hideFlashScreenshot</code> which will do the reverse: hide our screenshot and then display our Flash Object again. Basically, when a Dialog is opened we want to execute <code>displayFlashScreenshot</code> to display our screenshot and when the Dialog is closed we want to execute <code>hideFlashScreenshot</code> to display our Flash content.</p>
<p>Next we create a new method <code>onFlashHide</code> to handle the open/close state and assign it to the <code> hideFlashCallback </code> parameter in <code>FB.init</code>. In <code>onFlashHide</code> we check the <code>info.state</code> property and then call the corresponding JavaScript method.</p>
<p>
<strong>JavaScript</strong>
</p>
<pre>
function displayFlashScreenshot() {
  // Call the Flash Actionscript method to create the dynamic screenshot data
  var screenshotData =
    document.getElementById(&apos;flashObject&apos;).exportScreenshot();

  // Set the screenshot image data as a base64 encoded data URI
  // in the img src attribute
  document.getElementById(&apos;screenshotObject&apos;).src = &apos;data:image/jpeg;base64,&apos;
    + screenshotData;

  // Set the screenshot img dimensions to match the Flash object tag.
  document.getElementById(&apos;screenshotObject&apos;).width = flashObject.width;
  document.getElementById(&apos;screenshotObject&apos;).height = flashObject.height;
        
  // Move the Flash object off the screen and place the screenshot img
  document.getElementById(&apos;flashContent&apos;).style.top = &apos;-10000px&apos;;
  document.getElementById(&apos;imageContent&apos;).style.top = &apos;&apos;;
}

function hideFlashScreenshot() {
  // Move the screenshot img off the screen and place the Flash object
  document.getElementById(&apos;flashContent&apos;).style.top = &apos;&apos;;
  document.getElementById(&apos;imageContent&apos;).style.top = &apos;-10000px&apos;;
}

function onFlashHide(info) {
  if(info.state == &apos;opened&apos;) {
    displayFlashScreenshot();
  } else {
    hideFlashScreenshot();
  }
}

FB.init({
  appId  : &apos;APP_ID&apos;,
  hideFlashCallback : onFlashHide
});
</pre>
<p>
<a name="source_code">
</a>
</p>
<p>For more information on the <code>hideFlashCallback </code> parameter see the <a href="https://developers.dev.facebook.com/docs/reference/javascript/#flash_hide_callback" name="https://developers.dev.facebook.com/docs/reference/javascript/#flash_hide_callback">JavaScript SDK Docs</a>.  </p>
<h2>Full Source Code for the Example App</h2>
<p>
<a href="https://developers.facebook.com/attachment/flash_screenshot_example.zip" name="https://developers.facebook.com/attachment/flash_screenshot_example.zip">Download</a> the source code for the <a href="https://developers.facebook.com/attachment/flash_screenshot_example.zip" name="https://developers.facebook.com/attachment/flash_screenshot_example.zip">Example App</a> which includes the HTML, JavaScript and ActionScript code referenced in the examples above.</p>
<div class="mtl pvm uiBoxWhite topborder">
<div class="mbm lfloat">
<fb:like href="http://developers.facebook.com/docs/hideflashcallback/" send="true" show_faces="false">
</fb:like>
</div>
<div class="clear">
<abbr class="timestamp" data-utime="1338843142" title="2012年6月4日 13:52">2012年6月4日 13:52</abbr>
</div>
</div></div>

</body>
</html>
