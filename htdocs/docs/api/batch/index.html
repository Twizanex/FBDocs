<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>https://developers.facebook.com/docs/api/batch/</title>
<link rel="stylesheet" href="/css/common.css" media="screen" />
<script src="/js/common.js"></script>
</head>
<body>
<a id="oklahomer-orig-url" href="https://developers.facebook.com/docs/api/batch/">https://developers.facebook.com/docs/api/batch/</a>

<div id="oklahomer-menu-wrapper">
<div class="toplevelnav">
<ul>
<li>
<a href="/docs/" name="https://developers.facebook.com/docs/">
<div class="navSectionTitle">Getting Started</div>
</a>
</li>
<li class="active withsubsections">
<a class="selected" href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts">
<div class="navSectionTitle">Core Concepts</div>
</a>
<ul class="subsections">
<li>
<a href="https://developers.facebook.com/socialdesign" name="https://developers.facebook.com/socialdesign" target="_blank">Social Design</a>
</li>
<li>
<a href="/docs/plugins/" name="https://developers.facebook.com/docs/plugins">Social Plugins</a>
</li>
<li>
<a href="/docs/opengraph/" name="https://developers.facebook.com/docs/opengraph">Open Graph</a>
</li>
<li>
<a href="/docs/channels/" name="https://developers.facebook.com/docs/channels">Social Channels</a>
</li>
<li>
<a href="/docs/authentication/" name="https://developers.facebook.com/docs/authentication">Authentication</a>
</li>
<li>
<a class="selected" href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api">Graph API</a>
</li>
</ul>
</li>
<li>
<a href="/docs/advancedtopics/" name="https://developers.facebook.com/docs/advancedtopics">
<div class="navSectionTitle">Advanced Topics</div>
</a>
</li>
<li>
<a href="/docs/sdks/" name="https://developers.facebook.com/docs/sdks">
<div class="navSectionTitle">SDK Reference</div>
</a>
</li>
<li>
<a href="https://developers.facebook.com/tools" name="https://developers.facebook.com/tools" target="_blank">
<div class="navSectionTitle">Tools</div>
</a>
</li>
</ul>
</div>
<ul id="navsubsectionpages">
<li>
</li>
<li>
<h5>Concepts</h5>
<ul>
<li>
<a href="/docs/reference/api/batch/" name="http://developers.facebook.com/docs/reference/api/batch/">Batch Requests</a>
</li>
<li>
<a href="/docs/reference/api/permissions/" name="http://developers.facebook.com/docs/reference/api/permissions/">Permissions</a>
</li>
<li>
<a href="/docs/reference/api/realtime/" name="http://developers.facebook.com/docs/reference/api/realtime/">Real-time Updates</a>
</li>
</ul>
</li>
<li>
<h5>Objects</h5>
<ul>
<li>
<a href="/docs/reference/api/achievement/" name="http://developers.facebook.com/docs/reference/api/achievement/">Achievement(Instance)</a>
</li>
<li>
<a href="/docs/reference/api/album/" name="http://developers.facebook.com/docs/reference/api/album/">Album</a>
</li>
<li>
<a href="/docs/reference/api/application/" name="http://developers.facebook.com/docs/reference/api/application/">Application</a>
</li>
<li>
<a href="/docs/reference/api/checkin/" name="http://developers.facebook.com/docs/reference/api/checkin/">Checkin</a>
</li>
<li>
<a href="/docs/reference/api/Comment/" name="http://developers.facebook.com/docs/reference/api/Comment/">Comment</a>
</li>
<li>
<a href="/docs/reference/api/domain/" name="http://developers.facebook.com/docs/reference/api/domain/">Domain</a>
</li>
<li>
<a href="/docs/reference/api/event/" name="http://developers.facebook.com/docs/reference/api/event/">Event</a>
</li>
<li>
<a href="/docs/reference/api/FriendList/" name="http://developers.facebook.com/docs/reference/api/FriendList/">FriendList</a>
</li>
<li>
<a href="/docs/reference/api/group/" name="http://developers.facebook.com/docs/reference/api/group/">Group</a>
</li>
<li>
<a href="/docs/reference/api/insights/" name="http://developers.facebook.com/docs/reference/api/insights/">Insights</a>
</li>
<li>
<a href="/docs/reference/api/link/" name="http://developers.facebook.com/docs/reference/api/link/">Link</a>
</li>
<li>
<a href="/docs/reference/api/message/" name="http://developers.facebook.com/docs/reference/api/message/">Message</a>
</li>
<li>
<a href="/docs/reference/api/note/" name="http://developers.facebook.com/docs/reference/api/note/">Note</a>
</li>
<li>
<a href="/docs/reference/api/offer/" name="http://developers.facebook.com/docs/reference/api/offer/">Offer</a>
</li>
<li>
<a href="/docs/reference/api/order/" name="http://developers.facebook.com/docs/reference/api/order/">Order </a>
</li>
<li>
<a href="/docs/reference/api/page/" name="http://developers.facebook.com/docs/reference/api/page/">Page</a>
</li>
<li>
<a href="/docs/reference/api/photo/" name="http://developers.facebook.com/docs/reference/api/photo/">Photo</a>
</li>
<li>
<a href="/docs/reference/api/post/" name="http://developers.facebook.com/docs/reference/api/post/">Post</a>
</li>
<li>
<a href="/docs/reference/api/question/" name="http://developers.facebook.com/docs/reference/api/question/">Question</a>
</li>
<li>
<a href="/docs/reference/api/question_option/" name="http://developers.facebook.com/docs/reference/api/question_option/">QuestionOption</a>
</li>
<li>
<a href="/docs/reference/api/Review/" name="http://developers.facebook.com/docs/reference/api/Review/">Review</a>
</li>
<li>
<a href="/docs/reference/api/status/" name="http://developers.facebook.com/docs/reference/api/status/">Status message</a>
</li>
<li>
<a href="/docs/reference/api/thread/" name="http://developers.facebook.com/docs/reference/api/thread/">Thread</a>
</li>
<li>
<a href="/docs/reference/api/user/" name="http://developers.facebook.com/docs/reference/api/user/">User</a>
</li>
<li>
<a href="/docs/reference/api/video/" name="http://developers.facebook.com/docs/reference/api/video/">Video</a>
</li>
</ul>
</li>
</ul></div>

<div id="oklahomer-content-wrapper">
<div class="header">
<div class="content">
<h1>Batch Requests</h1>
<div class="breadcrumbs">
<a href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts/">Core Concepts</a> › <a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api/">Graph API</a> › <a href="/docs/reference/api/batch/" name="https://developers.facebook.com/docs/reference/api/batch/">Batch Requests</a>
</div>
</div>
</div>
<h2>Introduction</h2>
<p>The standard version of the <a href="/docs/api/batch/" name="https://developers.facebook.com/docs/api/batch/">Graph API</a> is designed to make it really easy to get data for an individual object and to browse connections between objects. It also includes a limited ability to retrieve data for a few objects at the same time.</p>
<p>If your application needs the ability to access significant amounts of data in a single go - or you need to make changes to several objects at once, it is often more efficient batch your queries rather than make multiple individual HTTP requests.</p>
<p>To enable this, the Graph API support Batching. Batching allows you to pass instructions for several operations in a single HTTP request. You can also specify dependencies between related operations (described in a section below). Facebook will process each of your independent operations in parallel and will process your dependent operations sequentially. Once all operations have been completed, a consolidated response will be passed back to you and the HTTP connection will be closed.</p>
<h2>Making a simple batched request</h2>
<p>The batch API takes in an array of logical HTTP requests represented as JSON arrays - each request has a method (corresponding to HTTP method GET/PUT/POST/DELETE etc), a relative_url (the portion of the URL after graph.facebook.com), optional headers array (corresponding to HTTP headers) and an optional body (for POST and PUT requests). The Batch API returns an array of logical HTTP responses represented as JSON arrays - each response has a status code, an optional headers array and an optional body (which is a JSON encoded string).</p>
<p>To make batched requests, you build a JSON object which describes each individual operation you&apos;d like to perform and <code>POST</code> this to the Graph API endpoint at <code>https://graph.facebook.com</code>. The following example gets the current user&apos;s profile information and the first 50 friends from their friends list in a single request:</p>
<pre>
<code>curl \
    -F &apos;access_token=…&apos; \
    -F &apos;batch=[ \
            {&quot;method&quot;: &quot;GET&quot;, &quot;relative_url&quot;: &quot;me&quot;}, \
            {&quot;method&quot;: &quot;GET&quot;, &quot;relative_url&quot;: &quot;me/friends?limit=50&quot;} \
        ]&apos;\
    https://graph.facebook.com
</code>
</pre>
<p>Once both operations have been completed, Facebook sends a response which encapsulates the result of all the operations. For each operation, the response includes a status code, header information, and the body. These are equivalent to the response you could expect from each operation if performed as raw requests against the Graph API. The body field contains a string encoded JSON object:</p>
<p>For the above request, the expected response would be of the form:</p>
<pre>
<code>[
    { &quot;code&quot;: 200, 
      &quot;headers&quot;:[
          { &quot;name&quot;: &quot;Content-Type&quot;, 
            &quot;value&quot;: &quot;text/javascript; charset=UTF-8&quot; }
      ],
      &quot;body&quot;: &quot;{\&quot;id\&quot;:\&quot;…\&quot;}&quot;},
    { &quot;code&quot;: 200,
      &quot;headers&quot;:[
          { &quot;name&quot;:&quot;Content-Type&quot;, 
            &quot;value&quot;:&quot;text/javascript; charset=UTF-8&quot;}
      ],
      &quot;body&quot;:&quot;{\&quot;data\&quot;: [{…}]}}
]
</code>
</pre>
<p>
<a name="multiple_methods">
</a>
</p>
<h2>Batch requests containing multiple methods</h2>
<p>It is possible to combine operations that would normally use different HTTP methods into a single batch request. While <code>GET</code> and <code>DELETE</code> operations must only have a <code>relative_url</code> and a <code>method</code> field, <code>POST</code> and <code>PUT</code> operations may contain an optional <code>body</code> field. This should be formatted as a raw HTTP POST body string, similar to a URL query string. The following example writes a new post to the user&apos;s news feed, and then gets the top item from their news feed in a single operation:</p>
<pre>
<code>curl \
    –F &apos;access_token=…&apos; \
    -F &apos;batch=[ \
          { &quot;method&quot;: &quot;POST&quot;, \
            &quot;relative_url&quot;: &quot;me/feed&quot;, \
            &quot;body&quot;: &quot;message=Test status update&amp;link=https://developers.facebook.com/&quot; \
          }, \
          { &quot;method&quot;:&quot;GET&quot;, \
            &quot;relative_url&quot;:&quot;me/feed?limit=1&quot; \
          } \
        ]&apos;\
    https://graph.facebook.com
</code>
</pre>
<p>The output of this call would be:</p>
<pre>
<code>[
    { &quot;code&quot;: 200,
      &quot;headers&quot;: [
          { &quot;name&quot;:&quot;Content-Type&quot;, 
            &quot;value&quot;:&quot;text/javascript; charset=UTF-8&quot;}
       ],
      &quot;body&quot;:&quot;{\&quot;id\&quot;:\&quot;…\&quot;}&quot;
    },
    { &quot;code&quot;: 200,
      &quot;headers&quot;: [
          { &quot;name&quot;:&quot;Content-Type&quot;, 
            &quot;value&quot;:&quot;text/javascript; charset=UTF-8&quot;
          },
          { &quot;name&quot;:&quot;ETag&quot;, 
            &quot;value&quot;: &quot;…&quot;
          }
      ],
      &quot;body&quot;: &quot;{\&quot;data\&quot;: [{…}]}
    }
]
</code>
</pre>
<h2>Errors</h2>
<p>Its possible that one of your requested operations may throw an error. This could be because, for example, you don&apos;t have permission to perform the requested operation. In this scenario, the batch API throws a similar response to the standard Graph API, but encapsulated in the batch response syntax:</p>
<pre>
<code>curl \
     -F &apos;access_token=...&apos;\
     -F &apos;batch=[{ &quot;method&quot;: &quot;POST&quot;, \
              &quot;relative_url&quot;: &quot;me/feed&quot;, \
                  &quot;body&quot;: &quot;message=Test update&quot;}]\
https://graph.facebook.com
</code>
</pre>
<p>Let say, for example, that the access token used above didn&apos;t have the <code>publish_stream</code> permission. The response would be of the form:</p>
<pre>
<code>[
    { &quot;code&quot;: 403,
      &quot;headers&quot;: [
          {&quot;name&quot;:&quot;WWW-Authenticate&quot;, &quot;value&quot;:&quot;OAuth…&quot;},
          {&quot;name&quot;:&quot;Content-Type&quot;, &quot;value&quot;:&quot;text/javascript; charset=UTF-8&quot;} ],
      &quot;body&quot;: &quot;{\&quot;error\&quot;:{\&quot;type\&quot;:\&quot;OAuthException\&quot;, … }}&quot;
    }
]
</code>
</pre>
<p>Other requests within the batch should still complete successfully and will be returned, as normal, with a <code>200</code> status code.</p>
<p>
<a name="fql">
</a>
</p>
<h2>Using fql.query and fql.multiquery in the Batch API</h2>
<p>In general, the graph Batch API does not support the legacy REST API methods. However it is possible to include fql.query and fql.multiquery operations as part of the graph Batch API request. For example, you can include an FQL query in the batch API request as follows</p>
<pre>
<code>curl \
     -F &apos;access_token=…&apos; \
     -F &apos;batch=[{ &quot;method&quot;: &quot;POST&quot;, \
    &quot;relative_url&quot;: &quot;method/fql.query?query=select+name+from+user+where+uid=4&quot;, \
     }]
https://graph.facebook.com
</code>
</pre>
<p>
<a name="operations">
</a>
</p>
<h2>Specifying dependencies between operations in the request</h2>
<p>By default, the operations specified in the batch API request are independent - they can be executed in arbitrary order on the server and an error in one operation does not affect execution of other operations.</p>
<p>Often, the operations in the request are dependent - for example, the output of one operation may be used in the input of the next operation. The graph Batch API has support for this using the JSONPath expression format (http://code.google.com/p/jsonpath/). The JSONPath expression format provides a simple way to reference the data in a JSON object. In order to reference the results of a previous operation in another operation, you need to give a name to the previous (parent) operation, and then reference it inside the query string parameter or form post parameter using the JSONPath format. The syntax for embedding a JSONPath expression in a query string or form post parameter is {result=(parent operation name):(JSONPath expression)}. Note that for security reasons filter and script JSONPath constructs are not allowed in the JSONPath expression.</p>
<p>For example, to get the details of 5 of your friends, you can issue the following Batch request:</p>
<pre>
<code>curl \
   -F &apos;access_token=...&apos; \
   -F &apos;batch=[{ &quot;method&quot;: &quot;GET&quot;, \
                &quot;name&quot; : &quot;get-friends&quot;, \
                &quot;relative_url&quot;: &quot;me/friends?limit=5&quot;, \
              }, \
              { &quot;method&quot;: &quot;GET&quot;, \
                &quot;relative_url&quot;: &quot;?ids={result=get-friends:$.data.*.id}&quot; \
              }]&apos; \
      https://graph.facebook.com/
</code>
</pre>
<p>In the above example, the first operation is named get-friends, and the second operation uses the JSONPath syntax to extract all the friend ids from the output of the first operation in csv format. The JSONPath expression <code>$.data.*.id</code> implies &quot;extract the id attribute from all children of the top level element called data&quot;. Note that the output of a JSONPath expression must be a primitive or a list of primitives - the list of primitives gets exploded as a csv string.</p>
<p>In the above example, the server detects that the second operation depends on the first one, since the second operation references the result of the first one using JSONPath. The server executes a dependent operation only after the operation it depends on has finished executing. If the parent operation execution results in an error, then the subsequent operation is not executed. Also, by default the output of the parent operation is not included in the response if the operation executed successfully. So, the response to the above Batch API request would look like</p>
<pre>
<code>[
    null,
    { &quot;code&quot;: 200,
      &quot;headers&quot;:[
          { &quot;name&quot;:&quot;Content-Type&quot;, 
            &quot;value&quot;:&quot;text/javascript; charset=UTF-8&quot;}
      ],
      &quot;body&quot;:&quot;{\&quot;data\&quot;: [{…}]}}
]
</code>
</pre>
<p>You can force the server to include the output for the parent operation even if it executed successfully by specifying &quot;omit_response_on_success&quot;:false in the parent request operation. For example</p>
<pre>
<code>curl \
     -F &apos;access_token=...&apos; \
     -F &apos;batch=[{ &quot;method&quot;: &quot;GET&quot;, \
                  &quot;name&quot; : &quot;get-friends&quot;, \
                  &quot;relative_url&quot;: &quot;me/friends?limit=5&quot;, \
              &quot;omit_response_on_success&quot;: false, \
                }, \
                { &quot;method&quot;: &quot;GET&quot;, \
                  &quot;relative_url&quot;: &quot;?ids={result=get-friends:$.data.*.id}&quot; \
                }]&apos; \
                https://graph.facebook.com/
</code>
</pre>
<p>You can reference the results of a previous operation using JSONPath in form post parameters in addition to query string parameters. For example, the batch request below adds a status update that references a friend&apos;s name:</p>
<pre>
<code>curl -F &apos;access_token=...&apos;  \
     -F &apos;batch=[{ &quot;method&quot;: &quot;GET&quot;, \
                  &quot;name&quot; : &quot;one-friend&quot;, \
                  &quot;relative_url&quot;: &quot;me/friends?limit=1&quot;, \
                }, \
                { &quot;method&quot;: &quot;POST&quot;, \
                  &quot;relative_url&quot;: &quot;me/feed&quot;, \
                  &quot;body&quot;: &quot;message={result=one-friend:$.data.0.name} is my friend&quot; \
                }]&apos; \
        https://graph.facebook.com/
</code>
</pre>
<p>As mentioned above, the server automatically detects dependencies between operations based on the JSONPath expressions. However in some instances, the client may wish to specify dependencies between operations explicitly. This can be done using the depends_on attribute.</p>
<p>For example, in the request below, the fact that the second operation depends on the first one has been specified explicitly.</p>
<pre>
<code>curl 
    -F &apos;access_token=...&apos; \
    -F &apos;batch=[\
               { &quot;method&quot;: &quot;POST&quot;, \
                 &quot;name&quot;: &quot;first&quot;, \
                 &quot;relative_url&quot;: &quot;me/feed&quot;, \
                 &quot;body&quot;: &quot;message=Test status update&quot; \
               }, \
               { &quot;method&quot;:&quot;GET&quot;, \
                 &quot;depends_on&quot;: &quot;first&quot;, \
                 &quot;relative_url&quot;:&quot;me/feed?limit=1&quot; \
               }\
              ]&apos; \
    https://graph.facebook.com
</code>
</pre>
<h2>Batch calls with JSONP</h2>
<p>The Batch API supports JSONP, just like the rest of the Graph API - the JSONP callback function is specified using the &apos;callback&apos; query string or form post parameter.</p>
<h2 id="differentaccesstokens">Specifying different access tokens for different operations</h2>
<p>All the above examples specify a single access token as a top level parameter. The Batch API is flexible and allows individual requests to specify their own access tokens as a query string or form post parameter. In that case the top level access token is considered a fallback token and is used if an individual request has not explicitly specified an access token.</p>
<p>This may be useful when you want to query the API using several users&apos; different access tokens, or if some of your calls need to be made using an Application access token.</p>
<p>If none of the individual requests specify an access token to be used, you must include an access token as a top level parameter and this will be used for all requests.</p>
<h2>Uploading binary data</h2>
<p>Binary data can be specified as part of the multipart/mime portion of the batch API request. The batch Graph API allows uploading multiple binary items as part of a batch call. In order to do this, you need to add all the binary items as multipart/mime attachments to your request, and need each operation to reference its binary items using the &quot;attached_files&quot; property in the operation. The &quot;attached_files&quot; property can take a comma separated list of attachment names in its value.</p>
<p>The following example shows how to upload 2 photos in a single batch call:</p>
<pre>
<code>curl 
     –F  &apos;access_token=…&apos; \
     -F  &apos;batch=[{&quot;method&quot;:&quot;POST&quot;, \
                  &quot;relative_url&quot;:&quot;me/photos&quot;, \
                  &quot;body&quot;:&quot;message=My cat photo&quot; \
                  &quot;attached_files&quot;:&quot;file1&quot; \
                 },
                 {&quot;method&quot;:&quot;POST&quot;, \
                  &quot;relative_url&quot;:&quot;me/photos&quot;, \
                  &quot;body&quot;:&quot;message=My dog photo&quot; \
                  &quot;attached_files&quot;:&quot;file2&quot; \
                 },
                ]&apos;
     -F  &apos;file1=@cat.gif&apos; \
     -F &apos;file2=@dog.jpg&apos; \
    https://graph.facebook.com
</code>
</pre>
<h2>Limits</h2>
<p>We currently limit the number of batch requests to 50.</p>
<div class="mtl pvm uiBoxWhite topborder">
<div class="mbm lfloat">
<fb:like href="http://developers.facebook.com/docs/reference/api/batch/" send="true" show_faces="false">
</fb:like>
</div>
<div class="clear">
<abbr class="timestamp" data-utime="1335193193" title="2012年4月23日 7:59">2012年4月23日 7:59</abbr>
</div>
</div></div>

</body>
</html>
