<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>https://developers.facebook.com/docs/api/realtime/</title>
<link rel="stylesheet" href="/css/common.css" media="screen" />
<script src="/js/common.js"></script>
</head>
<body>
<a id="oklahomer-orig-url" href="https://developers.facebook.com/docs/api/realtime/">https://developers.facebook.com/docs/api/realtime/</a>

<div id="oklahomer-menu-wrapper">
<div class="toplevelnav">
<ul>
<li>
<a href="/docs/" name="https://developers.facebook.com/docs/">
<div class="navSectionTitle">Getting Started</div>
</a>
</li>
<li class="active withsubsections">
<a class="selected" href="/docs/coreconcepts" name="https://developers.facebook.com/docs/coreconcepts">
<div class="navSectionTitle">Core Concepts</div>
</a>
<ul class="subsections">
<li>
<a href="/socialdesign" name="https://developers.facebook.com/socialdesign">Social Design</a>
</li>
<li>
<a href="/docs/plugins" name="https://developers.facebook.com/docs/plugins">Social Plugins</a>
</li>
<li>
<a href="/docs/opengraph" name="https://developers.facebook.com/docs/opengraph">Open Graph</a>
</li>
<li>
<a href="/docs/channels" name="https://developers.facebook.com/docs/channels">Social Channels</a>
</li>
<li>
<a href="/docs/authentication" name="https://developers.facebook.com/docs/authentication">Authentication</a>
</li>
<li>
<a class="selected" href="/docs/reference/api" name="https://developers.facebook.com/docs/reference/api">Graph API</a>
</li>
</ul>
</li>
<li>
<a href="/docs/advancedtopics" name="https://developers.facebook.com/docs/advancedtopics">
<div class="navSectionTitle">Advanced Topics</div>
</a>
</li>
<li>
<a href="/docs/sdks" name="https://developers.facebook.com/docs/sdks">
<div class="navSectionTitle">SDK Reference</div>
</a>
</li>
<li>
<a href="/tools" name="https://developers.facebook.com/tools">
<div class="navSectionTitle">Tools</div>
</a>
</li>
</ul>
</div>
<ul id="navsubsectionpages">
<li>
</li>
<li>
<h5>Concepts</h5>
<ul>
<li>
<a href="http://developers.facebook.com/docs/reference/api/batch/" name="http://developers.facebook.com/docs/reference/api/batch/">Batch Requests</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/permissions/" name="http://developers.facebook.com/docs/reference/api/permissions/">Permissions</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/realtime/" name="http://developers.facebook.com/docs/reference/api/realtime/">Real-time Updates</a>
</li>
</ul>
</li>
<li>
<h5>Objects</h5>
<ul>
<li>
<a href="http://developers.facebook.com/docs/reference/api/achievement/" name="http://developers.facebook.com/docs/reference/api/achievement/">Achievement(Instance)</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/album/" name="http://developers.facebook.com/docs/reference/api/album/">Album</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/application/" name="http://developers.facebook.com/docs/reference/api/application/">Application</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/checkin/" name="http://developers.facebook.com/docs/reference/api/checkin/">Checkin</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/Comment/" name="http://developers.facebook.com/docs/reference/api/Comment/">Comment</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/domain/" name="http://developers.facebook.com/docs/reference/api/domain/">Domain</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/event/" name="http://developers.facebook.com/docs/reference/api/event/">Event</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/FriendList/" name="http://developers.facebook.com/docs/reference/api/FriendList/">FriendList</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/group/" name="http://developers.facebook.com/docs/reference/api/group/">Group</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/insights/" name="http://developers.facebook.com/docs/reference/api/insights/">Insights</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/link/" name="http://developers.facebook.com/docs/reference/api/link/">Link</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/message/" name="http://developers.facebook.com/docs/reference/api/message/">Message</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/note/" name="http://developers.facebook.com/docs/reference/api/note/">Note</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/offer/" name="http://developers.facebook.com/docs/reference/api/offer/">Offer</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/order/" name="http://developers.facebook.com/docs/reference/api/order/">Order </a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/page/" name="http://developers.facebook.com/docs/reference/api/page/">Page</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/photo/" name="http://developers.facebook.com/docs/reference/api/photo/">Photo</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/post/" name="http://developers.facebook.com/docs/reference/api/post/">Post</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/question/" name="http://developers.facebook.com/docs/reference/api/question/">Question</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/question_option/" name="http://developers.facebook.com/docs/reference/api/question_option/">QuestionOption</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/Review/" name="http://developers.facebook.com/docs/reference/api/Review/">Review</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/status/" name="http://developers.facebook.com/docs/reference/api/status/">Status message</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/thread/" name="http://developers.facebook.com/docs/reference/api/thread/">Thread</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/user/" name="http://developers.facebook.com/docs/reference/api/user/">User</a>
</li>
<li>
<a href="http://developers.facebook.com/docs/reference/api/video/" name="http://developers.facebook.com/docs/reference/api/video/">Video</a>
</li>
</ul>
</li>
</ul></div>

<div id="oklahomer-content-wrapper">
<div class="header">
<div class="content">
<h1>Real-time Updates</h1>
<div class="breadcrumbs">
<a href="/docs/coreconcepts/" name="https://developers.facebook.com/docs/coreconcepts/">Core Concepts</a> › <a href="/docs/reference/api/" name="https://developers.facebook.com/docs/reference/api/">Graph API</a> › <a href="/docs/reference/api/realtime/" name="https://developers.facebook.com/docs/reference/api/realtime/">Real-time Updates</a>
</div>
</div>
</div>
<h2>Introduction</h2>
<p>The <a href="./" name="https://developers.facebook.com/docs/">Graph API</a> supports real-time updates to enable your application using Facebook to subscribe to changes in data in Facebook. Your application can then cache data and receive updates, rather than polling Facebook’s servers. Caching data and using this API can improve the reliability of your application and decrease its load times.</p>
<p>Whenever a subscribed change occurs, Facebook makes an HTTP <code>POST</code> request to a callback URL you specify with a list of changes. Your application will generally receive notification of the change within a couple of minutes of its occurrence.</p>
<p>Here are the steps to set up a subscription:</p>
<ol>
<li>Set up an endpoint URL that receives both HTTP <code>GET</code> (for subscription verification) and <code>POST</code> (for actual change data) requests from Facebook. </li>
<li>Make a <code>POST</code> to the graph API url <code>https://graph.facebook.com/&lt;app-id&gt;/subscriptions</code> to subscribe, and be ready to handle the verification request.</li>
</ol>
<hr />
<h2>Objects</h2>
<p>You can currently subscribe to updates for these types of objects:</p>
<ul>
<li>
<a href="/docs/reference/api/user" name="https://developers.facebook.com/docs/reference/api/user">user</a> – Get notifications about particular fields and connections corresponding to user nodes in the <a href="./" name="https://developers.facebook.com/docs/">Graph API</a>.</li>
<li>
<a href="/docs/reference/api/permissions/" name="https://developers.facebook.com/docs/reference/api/permissions/">permissions</a> – Get notifications when your users change the permissions they afford your applications. The available permissions are listed in the scope table in the <a href="/docs/reference/api/permissions/" name="https://developers.facebook.com/docs/reference/api/permissions/">permissions API reference</a>.</li>
<li>
<a href="/docs/reference/api/page" name="https://developers.facebook.com/docs/reference/api/page">page</a> - Get notifications when pages that have installed your application as a Tab change their public properties. Note that the page topic is only used for subscribing to changes to public attributes of the page (like <code>name</code>, <code>category</code>, <code>picture</code> etc). This is the same information that is returned by the Graph API call <code>https://graph.facebook.com/&lt;PAGE_ID&gt;</code>. </li>
</ul>
<p>
<strong>Note:</strong> Not all properties and connections of the user object can be subscribed to.</p>
<p>You can subscribe to all of the User object properties except <code>verified</code>.</p>
<p>Here are the list of User connections to which you can subscribe: <code>feed</code>, <code>friends</code>, <code>activities</code>, <code>interests</code>, <code>music</code>, <code>books</code>, <code>movies</code>, <code>television</code>, <code>likes</code>, <code>checkins</code>, <code>location</code>.</p>
<p>You can&apos;t subscribe to these User connections yet: <code>home</code>, <code>tagged</code>, <code>posts</code>, <code>photos</code>, <code>albums</code>, <code>videos</code>, <code>groups</code>, <code>notes</code>, <code>events</code>, <code>inbox</code>, <code>outbox</code>, <code>updates</code>, <code>accounts</code>.</p>
<p>We will add support for more properties and connections in the future. If you are interested, please check back on this page at later time for updates.</p>
<hr />
<h2>Subscription APIs</h2>
<p>There are three things you can do by sending a request to <code>https://graph.facebook.com/&lt;app-id&gt;/subscriptions?access_token=...</code>
</p>
<p>The distinguishing difference among them is simply whether you send an HTTP <code>POST</code>, <code>GET</code>, or <code>DELETE</code> request.</p>
<ul>
<li>Add or modify a subscription (<code>POST</code>)</li>
<li>List each of your subscribed objects and their subscribed fields (<code>GET</code>)</li>
<li>Delete subscriptions (<code>DELETE</code>)</li>
</ul>
<p>In all cases, you must send an <a href="/docs/authentication/" name="https://developers.facebook.com/docs/authentication/">OAuth</a> Application access_token. App access tokens are obtained using your App ID and your App Secret:</p>
<p>
<code>https://graph.facebook.com/oauth/access_token?client_id=&lt;APP_ID&gt;&amp;client_secret=&lt;APP_SECRET&gt;&amp;grant_type=client_credentials</code>
</p>
<h3>Add or Modify a Subscription</h3>
<p>To setup a subscription, send a <code>POST</code> with the following parameters.</p>
<ul>
<li>
<code>object</code> - The type of the object you want to receive updates about, e.g. <code>user</code>, <code>page</code> or <code>permissions</code>. You will receive updates about all objects of that type which are connected to your application. For example, for <code>user</code>, you will get updates about all users who have auth&apos;d your app. For <code>page</code>, you will get updates about the pages which have added your application as a tab. </li>
<li>
<code>fields</code> - A comma-separated list. This is a list of properties or connections on the specified object. For example, to monitor changes to user&apos;s name, picture, friends, and News Feed, you would specify &quot;<code>name,picture,friends,feed</code>&quot; </li>
<li>
<code>callback_url</code> - A callback URL to which Facebook will post subscription updates.</li>
<li>
<code>verify_token</code> - A subscriber-provided opaque token that will be echoed back in the verification request to assist the subscriber in identifying which subscription request is being verified. This is from the PubSubHubbub spec.</li>
</ul>
<p>When Facebook received this <code>POST</code> this request, we will perform a <code>GET</code> on your callback URL to ensure it is valid and correctly setup to receive realtime updates. See below for information on Subscription Verification. The callback URL must respond with the correct response for the subscription to be created successfully.</p>
<p>Note that an application can only have one subscription for each object type. If a subscription already exists for this object type, then the newly posted data replaces any existing data.</p>
<h3>List Subscriptions</h3>
<p>Doing a <code>GET</code> returns JSON-encoded content that lists your subscriptions, up to one per object type.</p>
<pre>
<code>[
  {
    &quot;object&quot;: &quot;user&quot;,
    &quot;callback_url&quot;: &quot;http://www.xyz.com/sub_endpoint?xyz_token=123&quot;,
    &quot;fields&quot;: [&quot;email&quot;, &quot;friends&quot;, &quot;name&quot;, &quot;picture&quot;],
    &quot;active&quot;: true
  },
  {
    &quot;object&quot;: &quot;permissions&quot;,
    &quot;callback_url&quot;: &quot;http://www.xyz.com/sub_endpoint?xyz_token=123&quot;,
    &quot;fields&quot;: [&quot;email&quot;, &quot;read_stream&quot;],
    &quot;active&quot;: true
  },
  {
    &quot;object&quot;: &quot;errors&quot;,
    &quot;callback_url&quot;: &quot;http://www.otherdomain.com/sub_endpoint?xyz_token=456&quot;,
    &quot;fields&quot;: [&quot;canvas&quot;],
    &quot;active&quot;: true
  }
]
</code>
</pre>
<h3>Delete Subscriptions</h3>
<p>Sending a <code>DELETE</code> request deletes all of your subscriptions. If you specify an <code>object</code> parameter, it will only delete the corresponding object&apos;s subscription.</p>
<hr />
<h2>Your Callback Server</h2>
<p>Your callback server must handle two types of requests.</p>
<p>Facebook servers will make a single HTTP <code>GET</code> to your callback URL when you try to add or modify a subscription. After a successful subscription, Facebook servers will notify your server of changes by issuing HTTP <code>POST</code> requests to the same URL.</p>
<h3>Subscription Verification</h3>
<p>Before subscription addition/modification can complete, Facebook servers will make an HTTP GET to your callback URL with the following parameters:</p>
<ul>
<li>
<code>hub.mode</code> - The string <code>subscribe</code> is passed in this parameter</li>
<li>
<code>hub.challenge</code> - A random string</li>
<li>
<code>hub.verify_token</code> - The <code>verify_token</code> value you passed to Facebook</li>
</ul>
<p>The end point should first verify the <code>verify_token</code> value is what you passed to Facebook, then return the <code>hub.challenge</code> value. This verification technique prevents malicious apps from using the real-time feature as tool for distributed denial-of-service (DDoS) attacks.</p>
<p>
<em>Note for PHP developers: In PHP, dots and spaces in query parameter names are converted to underscores automatically. Therefore, you should access these parameters as $_GET[&quot;hub_mode&quot;],$_GET[&quot;hub_challenge&quot;] and $_GET[&quot;hub_verify_token&quot;] if you are writing your callback endpoint in PHP. See <a href="http://www.php.net/manual/en/language.variables.external.php" name="http://www.php.net/manual/en/language.variables.external.php">this note in the PHP language manual</a>.</em>
</p>
<h3>Change Notifications</h3>
<p>When data changes, and there is a valid subscription, Facebook servers will make an HTTP POST request to the callback_url you specified. The request will have content type of <code>application/json</code>; the body will be a JSON-encoded string containing one or more changes.</p>
<p>Here is one example <code>user</code> object subscription:</p>
<pre>
<code>{
&quot;object&quot;: &quot;user&quot;,
&quot;entry&quot;: 
[
    {
        &quot;uid&quot;: 1335845740,
        &quot;changed_fields&quot;: 
        [
            &quot;name&quot;,
            &quot;picture&quot;
        ],
       &quot;time&quot;: 232323
    },
    {
        &quot;uid&quot;: 1234,
        &quot;changed_fields&quot;: 
        [
            &quot;friends&quot;
        ],
       &quot;time&quot;: 232325
    }
]
}
</code>
</pre>
<p>Note that this does not include the actual data values; to obtain those, you can request them as normal, subject to the usual privacy restrictions. For data that you have access to any time, you may wish to query for that data immediately so that requesting it does not slow down load times when the user returns to your application.</p>
<p>Facebook aggregates changes and sends batched updates every 5 seconds or when number of unsent changes exceeds 1000, so your server(s) should be set up to handle this level of load.</p>
<p>If a change notification to your server fails, Facebook will retry again immediately, then a few times more, with decreasing frequency, over the next 24 hours.</p>
<p>With every response, Facebook sends the X-Hub-Signature HTTP header which contains the SHA1 signature over the response payload, using the application secret as the key - for example: &apos;X-Hub-Signature: sha1=12345...&apos;. The consumer can verify the signature to validate the integrity of the payload.</p>
<h3>Other Examples</h3>
<p>Here&apos;s what the data returned from an errors subscription might look like:</p>
<pre>
<code>{
&quot;i&quot;:1234,
&quot;o&quot;:&quot;errors&quot;,
&quot;u&quot;:4,
&quot;f&quot;:[&quot;canvas&quot;],
&quot;d&quot;:{
    &quot;url&quot;:&quot;http:\/\/www.example.com&quot;,
    &quot;suf&quot;:&quot;onethefarm\/&quot;,
    &quot;e&quot;:&quot;HTTPErrorException&quot;,
    &quot;c&quot;:&quot;500&quot;
    }
 }
</code>
</pre>
<h3>Sample Implementations</h3>
<p>You can find sample codes at this <a href="http://github.com/facebook/real-time/blob/master/samples/" name="http://github.com/facebook/real-time/blob/master/samples/">github location</a>.</p>
<div class="mtl pvm uiBoxWhite topborder">
<div class="mbm lfloat">
<fb:like href="http://developers.facebook.com/docs/reference/api/realtime/" send="true" show_faces="false">
</fb:like>
</div>
<div class="clear">
<abbr class="timestamp" data-utime="1337325592" title="2012年5月18日 0:19">約3週間前に更新</abbr>
</div>
</div></div>

</body>
</html>
